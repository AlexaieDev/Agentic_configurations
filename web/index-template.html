<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Workflow Selector</title>
    <style>
        /* ==================== CSS VARIABLES ==================== */
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --accent-light: #60a5fa;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --border: #334155;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4);
            --radius: 12px;
            --radius-sm: 8px;
            --transition: all 0.2s ease;
        }

        [data-theme="light"] {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #e2e8f0;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #94a3b8;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* ==================== RESET & BASE ==================== */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* ==================== LAYOUT ==================== */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1.5rem;
        }

        /* ==================== HEADER ==================== */
        header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo svg {
            width: 40px;
            height: 40px;
            fill: var(--accent);
        }

        .logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-stats {
            display: flex;
            gap: 1.5rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .stat-value {
            font-weight: 600;
            color: var(--accent);
        }

        .theme-toggle {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background: var(--accent);
        }

        .theme-toggle svg {
            width: 20px;
            height: 20px;
            fill: var(--text-primary);
        }

        /* ==================== GLOBAL SEARCH ==================== */
        .global-search {
            position: relative;
            flex: 1;
            max-width: 400px;
            margin: 0 1.5rem;
        }

        .global-search-input {
            width: 100%;
            padding: 0.6rem 1rem 0.6rem 2.5rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-primary);
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        .global-search-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
        }

        .global-search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 1rem;
        }

        .global-search-results {
            position: absolute;
            top: calc(100% + 0.5rem);
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            max-height: 400px;
            overflow-y: auto;
            z-index: 200;
            display: none;
        }

        .global-search-results.show {
            display: block;
        }

        .search-result-group {
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border);
        }

        .search-result-group:last-child {
            border-bottom: none;
        }

        .search-result-group-title {
            padding: 0.5rem 1rem;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .search-result-item {
            padding: 0.6rem 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: background 0.2s ease;
        }

        .search-result-item:hover {
            background: var(--bg-tertiary);
        }

        .search-result-icon {
            font-size: 1.25rem;
            line-height: 1;
        }

        .search-result-text {
            flex: 1;
            overflow: hidden;
        }

        .search-result-name {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .search-result-meta {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .search-no-results {
            padding: 1.5rem;
            text-align: center;
            color: var(--text-muted);
            font-size: 0.875rem;
        }

        .search-shortcut {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.7rem;
            color: var(--text-muted);
            background: var(--bg-primary);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            border: 1px solid var(--border);
        }

        @media (max-width: 768px) {
            .global-search {
                max-width: none;
                margin: 0.5rem 0;
                order: 3;
                width: 100%;
            }
            .search-shortcut {
                display: none;
            }
        }

        /* ==================== NAVIGATION ==================== */
        nav {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 0.75rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            transition: box-shadow 0.3s ease;
        }

        nav.scrolled {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .nav-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: var(--accent);
            width: 0%;
            transition: width 0.1s ease-out;
        }

        .nav-links {
            display: flex;
            gap: 0.5rem;
            list-style: none;
            overflow-x: auto;
            padding-bottom: 0.25rem;
        }

        .nav-links a {
            display: block;
            padding: 0.5rem 1rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
            font-weight: 500;
            white-space: nowrap;
            transition: var(--transition);
        }

        .nav-links a:hover,
        .nav-links a.active {
            background: var(--accent);
            color: white;
        }

        /* Back to Top Button */
        .back-to-top {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 48px;
            height: 48px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
            z-index: 99;
        }

        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }

        .back-to-top:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.5);
        }

        /* ==================== SECTIONS ==================== */
        section {
            padding: 3rem 0;
        }

        .section-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .section-header h2 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .section-header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        /* ==================== WIZARD ==================== */
        #wizard {
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
            border-radius: var(--radius);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .wizard-steps {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .wizard-step {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--bg-primary);
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
            color: var(--text-muted);
            transition: var(--transition);
        }

        .wizard-step.active {
            background: var(--accent);
            color: white;
        }

        .wizard-step.completed {
            background: var(--success);
            color: white;
        }

        .wizard-step-number {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.75rem;
        }

        .wizard-step.active .wizard-step-number,
        .wizard-step.completed .wizard-step-number {
            background: rgba(255,255,255,0.2);
        }

        .wizard-content {
            min-height: 300px;
        }

        .wizard-page {
            display: none;
        }

        .wizard-page.active {
            display: block;
        }

        .wizard-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }

        .wizard-option {
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            padding: 1.25rem;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .wizard-option:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .wizard-option.selected {
            border-color: var(--accent);
            background: rgba(59, 130, 246, 0.1);
        }

        .wizard-option-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .wizard-option-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .wizard-option-desc {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .wizard-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ==================== RESULT ==================== */
        .wizard-result {
            display: none;
            text-align: center;
        }

        .wizard-result.show {
            display: block;
        }

        .result-workflow {
            background: var(--bg-primary);
            border-radius: var(--radius);
            padding: 2rem;
            margin-top: 1.5rem;
        }

        .result-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 1rem;
        }

        /* Journey View - Wizard Result */
        .journey-agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 0.75rem;
            margin: 1.5rem 0;
            text-align: left;
        }

        .journey-agent-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .journey-agent-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .journey-agent-card.selected {
            border-color: var(--success);
            background: rgba(34, 197, 94, 0.1);
        }

        .journey-agent-icon {
            font-size: 1.5rem;
        }

        .journey-agent-info {
            flex: 1;
            overflow: hidden;
        }

        .journey-agent-name {
            font-size: 0.8rem;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .journey-agent-check {
            width: 22px;
            height: 22px;
            border: 2px solid var(--border);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .journey-agent-card.selected .journey-agent-check {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .journey-actions {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .journey-btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-sm);
            font-weight: 500;
            cursor: pointer;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
            border: none;
        }

        .journey-btn-primary {
            background: var(--accent);
            color: white;
        }

        .journey-btn-primary:hover {
            background: var(--accent-light);
            transform: translateY(-2px);
        }

        .journey-btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .journey-btn-secondary:hover {
            border-color: var(--accent);
        }

        .journey-templates {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border);
        }

        .journey-templates-title {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .journey-template-btns {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .journey-template-btn {
            padding: 0.5rem 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .journey-template-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        /* ==================== WORKFLOWS ==================== */
        .workflows-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 1.5rem;
        }

        .workflow-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.5rem;
            transition: var(--transition);
        }

        .workflow-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .workflow-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .workflow-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .workflow-title {
            font-weight: 600;
            font-size: 1rem;
        }

        .workflow-subtitle {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .workflow-flow {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .workflow-node {
            background: var(--bg-tertiary);
            padding: 0.5rem 0.75rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .workflow-node:hover {
            background: var(--accent);
            color: white;
        }

        .workflow-arrow {
            color: var(--text-muted);
            font-size: 0.875rem;
        }

        .workflow-signals {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .workflow-signals-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .workflow-signals-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .signal-tag {
            background: rgba(59, 130, 246, 0.1);
            color: var(--accent);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
        }

        /* ==================== CATEGORY DASHBOARD ==================== */
        .category-dashboard {
            margin-bottom: 2rem;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 1rem;
        }

        .category-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .category-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .category-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-color: var(--accent);
        }

        .category-card:hover::before {
            transform: scaleX(1);
        }

        .category-card.active {
            border-color: var(--accent);
            background: rgba(139, 92, 246, 0.1);
        }

        .category-card.active::before {
            transform: scaleX(1);
        }

        .category-card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .category-card-icon {
            font-size: 1.75rem;
            line-height: 1;
        }

        .category-card-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .category-card-count {
            font-size: 0.75rem;
            color: var(--text-muted);
            background: var(--bg-tertiary);
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            margin-left: auto;
        }

        .category-card-preview {
            list-style: none;
            padding: 0;
            margin: 0;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .category-card-preview li {
            padding: 0.25rem 0;
            border-bottom: 1px solid var(--border);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .category-card-preview li.category-preview-agent {
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .category-card-preview li.category-preview-agent:hover {
            color: var(--primary);
            text-decoration: underline;
        }

        .category-card-preview li:last-child {
            border-bottom: none;
        }

        .category-card-footer {
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
        }

        .category-card-link {
            font-size: 0.75rem;
            color: var(--accent);
            text-decoration: none;
            font-weight: 500;
        }

        .category-card-link:hover {
            text-decoration: underline;
        }

        /* ==================== STACK BUILDER ==================== */
        .stack-panel {
            position: fixed;
            right: 0;
            top: 0;
            bottom: 0;
            width: 320px;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border);
            z-index: 150;
            display: flex;
            flex-direction: column;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            box-shadow: -5px 0 30px rgba(0, 0, 0, 0.1);
        }

        .stack-panel.open {
            transform: translateX(0);
        }

        .stack-panel-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-tertiary);
        }

        .stack-panel-title {
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .stack-count {
            background: var(--accent);
            color: white;
            font-size: 0.75rem;
            padding: 0.15rem 0.5rem;
            border-radius: 10px;
            font-weight: 600;
        }

        .stack-panel-close {
            background: none;
            border: none;
            font-size: 1.25rem;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0.25rem;
        }

        .stack-panel-close:hover {
            color: var(--danger);
        }

        .stack-panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .stack-empty {
            text-align: center;
            color: var(--text-muted);
            padding: 2rem 1rem;
            font-size: 0.875rem;
        }

        .stack-empty-icon {
            font-size: 2.5rem;
            margin-bottom: 0.75rem;
            opacity: 0.5;
        }

        .stack-item {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: grab;
            transition: all 0.2s ease;
        }

        .stack-item:hover {
            border-color: var(--accent);
        }

        .stack-item-icon {
            font-size: 1.25rem;
        }

        .stack-item-info {
            flex: 1;
            overflow: hidden;
        }

        .stack-item-name {
            font-size: 0.8rem;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .stack-item-category {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .stack-item-remove {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1rem;
            padding: 0.25rem;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .stack-item-remove:hover {
            background: var(--danger);
            color: white;
        }

        .stack-panel-footer {
            padding: 1rem;
            border-top: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .stack-btn {
            width: 100%;
            padding: 0.75rem;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 500;
            cursor: pointer;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
        }

        .stack-btn-primary {
            background: var(--accent);
            color: white;
        }

        .stack-btn-primary:hover {
            background: var(--accent-light);
            transform: translateY(-1px);
        }

        .stack-btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .stack-btn-secondary:hover {
            border-color: var(--accent);
        }

        .stack-btn-danger {
            background: transparent;
            color: var(--danger);
            font-size: 0.8rem;
        }

        .stack-btn-danger:hover {
            background: rgba(239, 68, 68, 0.1);
        }

        /* Stack Toggle Button */
        .stack-toggle {
            position: fixed;
            right: 1.5rem;
            bottom: 5rem;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            cursor: pointer;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4);
            z-index: 98;
            transition: all 0.3s ease;
        }

        .stack-toggle:hover {
            transform: scale(1.1);
        }

        .stack-toggle-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            font-size: 0.7rem;
            min-width: 20px;
            height: 20px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        /* Agent Card Add Button */
        .agent-add-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 4px;
            width: 28px;
            height: 28px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: var(--text-secondary);
            transition: all 0.2s ease;
            opacity: 0;
        }

        .agent-card:hover .agent-add-btn {
            opacity: 1;
        }

        .agent-add-btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .agent-add-btn.added {
            background: var(--success);
            color: white;
            border-color: var(--success);
            opacity: 1;
        }

        @media (max-width: 768px) {
            .stack-panel {
                width: 100%;
            }
            .stack-toggle {
                right: 1rem;
                bottom: 6rem;
            }
        }

        /* ==================== CATALOG ==================== */
        .catalog-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: var(--radius);
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-label {
            display: block;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
        }

        .filter-select,
        .filter-input {
            width: 100%;
            padding: 0.5rem 0.75rem;
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .filter-select:focus,
        .filter-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }

        .agent-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.25rem;
            transition: var(--transition);
            cursor: pointer;
        }

        .agent-card:hover {
            transform: translateY(-2px);
            border-color: var(--accent);
        }

        .agent-header {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .agent-icon {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            flex-shrink: 0;
        }

        .agent-name {
            font-weight: 600;
            font-size: 0.9rem;
            line-height: 1.3;
        }

        .agent-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .agent-tag {
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        .tag-pack {
            background: rgba(139, 92, 246, 0.15);
            color: #a78bfa;
        }

        .tag-category {
            background: rgba(34, 197, 94, 0.15);
            color: #4ade80;
        }

        .tag-platform {
            background: rgba(59, 130, 246, 0.15);
            color: #60a5fa;
        }

        /* ==================== KITS ==================== */
        .kits-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .kit-tab {
            padding: 0.75rem 1.5rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }

        .kit-tab:hover {
            border-color: var(--accent);
        }

        .kit-tab.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .kit-content {
            display: none;
        }

        .kit-content.active {
            display: block;
        }

        .kit-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .kit-section-title {
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .kit-agents {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .kit-agent {
            background: var(--bg-tertiary);
            padding: 0.5rem 0.75rem;
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
        }

        .kit-badge {
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .badge-required {
            background: rgba(239, 68, 68, 0.15);
            color: #f87171;
        }

        .badge-recommended {
            background: rgba(245, 158, 11, 0.15);
            color: #fbbf24;
        }

        .badge-optional {
            background: rgba(34, 197, 94, 0.15);
            color: #4ade80;
        }

        /* ==================== TOOLTIP ==================== */
        .tooltip {
            position: fixed;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 1rem;
            max-width: 300px;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            display: none;
        }

        .tooltip.show {
            display: block;
        }

        .tooltip-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .tooltip-desc {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* ==================== FOOTER ==================== */
        footer {
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
            padding: 2rem 0;
            text-align: center;
            color: var(--text-muted);
            font-size: 0.875rem;
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }

            .header-stats {
                flex-wrap: wrap;
                justify-content: center;
            }

            .workflows-grid {
                grid-template-columns: 1fr;
            }

            .wizard-options {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            .section-header h2 {
                font-size: 1.5rem;
            }
        }

        /* ==================== PHASES TIMELINE ==================== */
        .phases-timeline {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .phase-group {
            background: var(--bg-primary);
            border-radius: var(--radius);
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .phase-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.25rem 1.5rem;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: var(--transition);
        }

        .phase-header:hover {
            background: var(--bg-primary);
        }

        .phase-icon {
            font-size: 1.75rem;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-sm);
            background: var(--accent);
        }

        .phase-info {
            flex: 1;
        }

        .phase-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .phase-description {
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        .phase-count {
            background: var(--accent);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .phase-toggle {
            font-size: 1.25rem;
            color: var(--text-muted);
            transition: transform 0.3s ease;
        }

        .phase-group.expanded .phase-toggle {
            transform: rotate(180deg);
        }

        .phase-workflows {
            display: none;
            padding: 1.5rem;
            gap: 1rem;
        }

        .phase-group.expanded .phase-workflows {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        }

        .phase-workflow-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 1rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .phase-workflow-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .phase-workflow-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .phase-workflow-icon {
            font-size: 1.5rem;
        }

        .phase-workflow-title {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .phase-workflow-agents {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .phase-workflow-agent {
            background: var(--bg-primary);
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            color: var(--text-muted);
            cursor: pointer;
            transition: var(--transition);
        }

        .phase-workflow-agent:hover {
            background: var(--accent);
            color: white;
        }

        /* Phase colors */
        .phase-planificacion .phase-icon { background: rgba(139, 92, 246, 0.3); }
        .phase-desarrollo .phase-icon { background: rgba(59, 130, 246, 0.3); }
        .phase-testing .phase-icon { background: rgba(34, 197, 94, 0.3); }
        .phase-deploy .phase-icon { background: rgba(245, 158, 11, 0.3); }
        .phase-mantenimiento .phase-icon { background: rgba(239, 68, 68, 0.3); }

        @media (max-width: 768px) {
            .phase-group.expanded .phase-workflows {
                grid-template-columns: 1fr;
            }
        }

        /* ==================== CATEGORY COLORS ==================== */
        .cat-architecture { background: rgba(139, 92, 246, 0.2); }
        .cat-development { background: rgba(59, 130, 246, 0.2); }
        .cat-quality { background: rgba(34, 197, 94, 0.2); }
        .cat-security { background: rgba(239, 68, 68, 0.2); }
        .cat-cloud { background: rgba(245, 158, 11, 0.2); }
        .cat-transversal { background: rgba(236, 72, 153, 0.2); }
        .cat-ops { background: rgba(20, 184, 166, 0.2); }
        .cat-mobile { background: rgba(99, 102, 241, 0.2); }
        .cat-data { background: rgba(251, 146, 60, 0.2); }
        .cat-languages { background: rgba(16, 185, 129, 0.2); }
        .cat-migrations { background: rgba(168, 85, 247, 0.2); }
        .cat-legacy-maintenance { background: rgba(234, 179, 8, 0.2); }
        .cat-roles { background: rgba(59, 130, 246, 0.2); }

        /* ==================== ANIMATIONS ==================== */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease forwards;
        }

        /* Hidden utility */
        .hidden {
            display: none !important;
        }

        /* ==================== MODAL ==================== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            width: 100%;
            max-width: 600px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-lg);
            transform: scale(0.9) translateY(20px);
            transition: transform 0.3s ease;
        }

        .modal-overlay.show .modal {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .modal-title-wrapper {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .modal-icon {
            width: 44px;
            height: 44px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .modal-title {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .modal-subtitle {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        .modal-close {
            background: var(--bg-tertiary);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .modal-close:hover {
            background: var(--danger);
            color: white;
        }

        .modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            flex: 1;
        }

        .modal-config {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 1rem;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.8rem;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: var(--text-primary);
            max-height: 350px;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }

        .copy-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .copy-btn:hover {
            background: var(--accent-hover);
        }

        .copy-btn.copied {
            background: var(--success);
        }

        .copy-btn .copy-icon {
            font-size: 1rem;
        }

        /* Clickable indicator */
        .agent-card::after,
        .workflow-node::after,
        .kit-agent::after {
            content: 'Click para ver';
            position: absolute;
            bottom: -24px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-tertiary);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.65rem;
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: none;
            white-space: nowrap;
        }

        .agent-card:hover::after {
            opacity: 1;
        }

        .agent-card {
            position: relative;
        }

        .kit-agent {
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .kit-agent:hover {
            background: var(--accent);
            color: white;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
                <h1>Agent Workflow Selector</h1>
            </div>
            <div class="header-stats">
                <div class="stat">
                    <span class="stat-value" id="stat-packs">-</span>
                    <span>Packs</span>
                </div>
                <div class="stat">
                    <span class="stat-value" id="stat-agents">-</span>
                    <span>Agentes</span>
                </div>
                <div class="stat">
                    <span class="stat-value" id="stat-workflows">-</span>
                    <span>Workflows</span>
                </div>
            </div>

            <!-- Global Search -->
            <div class="global-search" id="global-search">
                <span class="global-search-icon">🔍</span>
                <input type="text" class="global-search-input" id="global-search-input" placeholder="Buscar agentes, workflows, kits...">
                <span class="search-shortcut">Ctrl+K</span>
                <div class="global-search-results" id="global-search-results">
                    <!-- Results will be injected by JS -->
                </div>
            </div>

            <button class="theme-toggle" onclick="toggleTheme()" title="Cambiar tema">
                <svg class="sun-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/>
                </svg>
            </button>
        </div>
    </header>

    <!-- Navigation -->
    <nav id="main-nav">
        <div class="container">
            <ul class="nav-links">
                <li><a href="#catalog-section" class="active" data-section="catalog-section">Catalogo</a></li>
                <li><a href="#wizard-section" data-section="wizard-section">Wizard</a></li>
                <li><a href="#workflows-section" data-section="workflows-section">Workflows</a></li>
                <li><a href="#phases-section" data-section="phases-section">Por Fase</a></li>
                <li><a href="#kits-section" data-section="kits-section">Kits por Madurez</a></li>
            </ul>
        </div>
        <div class="nav-progress" id="nav-progress"></div>
    </nav>

    <!-- Back to Top Button -->
    <button class="back-to-top" id="back-to-top" aria-label="Volver arriba">↑</button>

    <!-- Stack Toggle Button -->
    <button class="stack-toggle" id="stack-toggle" aria-label="Mi Stack">
        📦
        <span class="stack-toggle-count" id="stack-toggle-count" style="display: none;">0</span>
    </button>

    <!-- Stack Panel -->
    <aside class="stack-panel" id="stack-panel">
        <div class="stack-panel-header">
            <div class="stack-panel-title">
                📦 Mi Stack
                <span class="stack-count" id="stack-count">0</span>
            </div>
            <button class="stack-panel-close" id="stack-panel-close">×</button>
        </div>
        <div class="stack-panel-content" id="stack-content">
            <div class="stack-empty">
                <div class="stack-empty-icon">📭</div>
                <p>Tu stack está vacío</p>
                <p style="font-size: 0.75rem; margin-top: 0.5rem;">Haz clic en + en las tarjetas de agentes para agregarlos</p>
            </div>
        </div>
        <div class="stack-panel-footer">
            <button class="stack-btn stack-btn-primary" id="stack-copy-all">
                📋 Copiar Todas las Configuraciones
            </button>
            <button class="stack-btn stack-btn-secondary" id="stack-export-json">
                💾 Exportar JSON
            </button>
            <button class="stack-btn stack-btn-danger" id="stack-clear">
                🗑️ Limpiar Stack
            </button>
        </div>
    </aside>

    <main>
        <!-- Catalog Section -->
        <section id="catalog-section">
            <div class="container">
                <div class="section-header">
                    <h2>Catalogo de Agentes</h2>
                    <p>Explora todos los agentes disponibles</p>
                </div>

                <!-- Category Dashboard -->
                <div class="category-dashboard" id="category-dashboard">
                    <div class="category-grid" id="category-grid">
                        <!-- Categories will be injected by JS -->
                    </div>
                </div>

                <div class="catalog-filters">
                    <div class="filter-group">
                        <label for="search">Buscar</label>
                        <input type="text" id="search-input" placeholder="Nombre o keyword...">
                    </div>
                    <div class="filter-group">
                        <label for="pack-filter">Pack</label>
                        <select id="pack-filter">
                            <option value="">Todos</option>
                            <option value="core">Core</option>
                            <option value="quality">Quality</option>
                            <option value="security">Security</option>
                            <option value="devops">DevOps</option>
                            <option value="data">Data</option>
                            <option value="product">Product</option>
                            <option value="specialized">Specialized</option>
                            <option value="strategic">Strategic</option>
                            <option value="languages">Languages</option>
                            <option value="migrations">Migrations</option>
                            <option value="legacy">Legacy</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="category-filter">Categoria</label>
                        <select id="category-filter">
                            <option value="">Todas</option>
                            <option value="web">Web</option>
                            <option value="mobile">Mobile</option>
                            <option value="backend">Backend</option>
                            <option value="devops">DevOps</option>
                            <option value="data">Data</option>
                            <option value="architecture">Architecture</option>
                            <option value="testing">Testing</option>
                            <option value="security">Security</option>
                            <option value="documentation">Documentation</option>
                            <option value="product">Product</option>
                            <option value="ai-ml">AI/ML</option>
                            <option value="analytics">Analytics</option>
                            <option value="design">Design</option>
                            <option value="legal">Legal</option>
                            <option value="database">Database</option>
                            <option value="integration">Integration</option>
                            <option value="maintenance">Maintenance</option>
                            <option value="languages">Languages</option>
                            <option value="migrations">Migrations</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="platform-filter">Plataforma</label>
                        <select id="platform-filter">
                            <option value="">Todas</option>
                            <option value="all">Multiplataforma</option>
                            <option value="web">Web</option>
                            <option value="mobile">Mobile</option>
                            <option value="desktop">Desktop</option>
                            <option value="backend">Backend</option>
                            <option value="cloud">Cloud</option>
                        </select>
                    </div>
                </div>

                <div class="agents-grid" id="agents-container">
                    <!-- Agents will be injected by JS -->
                </div>
            </div>
        </section>

        <!-- Wizard Section -->
        <section id="wizard-section">
            <div class="container">
                <div class="section-header">
                    <h2>Encuentra el Workflow Correcto</h2>
                    <p>Responde 3 preguntas para obtener la secuencia de agentes recomendada</p>
                </div>

                <div id="wizard">
                    <div class="wizard-steps">
                        <div class="wizard-step active" data-step="1">
                            <span class="wizard-step-number">1</span>
                            <span>Tipo de Problema</span>
                        </div>
                        <div class="wizard-step" data-step="2">
                            <span class="wizard-step-number">2</span>
                            <span>Plataforma</span>
                        </div>
                        <div class="wizard-step" data-step="3">
                            <span class="wizard-step-number">3</span>
                            <span>Tamano Equipo</span>
                        </div>
                    </div>

                    <div class="wizard-content">
                        <!-- Step 1: Problem Type -->
                        <div class="wizard-page active" data-page="1">
                            <div class="wizard-options" id="problem-options">
                                <div class="wizard-option" data-value="bug">
                                    <div class="wizard-option-icon">🐛</div>
                                    <div class="wizard-option-title">Bug/Regresion</div>
                                    <div class="wizard-option-desc">Error en codigo existente</div>
                                </div>
                                <div class="wizard-option" data-value="feature">
                                    <div class="wizard-option-icon">✨</div>
                                    <div class="wizard-option-title">Nueva Feature</div>
                                    <div class="wizard-option-desc">Implementar funcionalidad nueva</div>
                                </div>
                                <div class="wizard-option" data-value="debt">
                                    <div class="wizard-option-icon">🔧</div>
                                    <div class="wizard-option-title">Code Quality & Refactoring</div>
                                    <div class="wizard-option-desc">Refactor, duplicacion</div>
                                </div>
                                <div class="wizard-option" data-value="performance">
                                    <div class="wizard-option-icon">⚡</div>
                                    <div class="wizard-option-title">Performance/Costos</div>
                                    <div class="wizard-option-desc">Latencia, cloud cost</div>
                                </div>
                                <div class="wizard-option" data-value="cicd">
                                    <div class="wizard-option-icon">🔄</div>
                                    <div class="wizard-option-title">CI/CD Lento</div>
                                    <div class="wizard-option-desc">Pipelines, flakiness</div>
                                </div>
                                <div class="wizard-option" data-value="tech">
                                    <div class="wizard-option-icon">🔬</div>
                                    <div class="wizard-option-title">Seleccion Tecnologia</div>
                                    <div class="wizard-option-desc">Evaluar frameworks</div>
                                </div>
                                <div class="wizard-option" data-value="architecture">
                                    <div class="wizard-option-icon">🏗️</div>
                                    <div class="wizard-option-title">Arquitectura</div>
                                    <div class="wizard-option-desc">Diseno o rediseno</div>
                                </div>
                                <div class="wizard-option" data-value="incident">
                                    <div class="wizard-option-icon">🚨</div>
                                    <div class="wizard-option-title">Incidente Produccion</div>
                                    <div class="wizard-option-desc">Problema critico en prod</div>
                                </div>
                                <div class="wizard-option" data-value="sre">
                                    <div class="wizard-option-icon">📊</div>
                                    <div class="wizard-option-title">Operaciones/SRE</div>
                                    <div class="wizard-option-desc">Confiabilidad, SLOs</div>
                                </div>
                                <div class="wizard-option" data-value="compliance">
                                    <div class="wizard-option-icon">📋</div>
                                    <div class="wizard-option-title">Compliance/Licencias</div>
                                    <div class="wizard-option-desc">Auditoria, licencias OSS</div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 2: Platform -->
                        <div class="wizard-page" data-page="2">
                            <div class="wizard-options" id="platform-options">
                                <div class="wizard-option" data-value="web">
                                    <div class="wizard-option-icon">🌐</div>
                                    <div class="wizard-option-title">Web</div>
                                    <div class="wizard-option-desc">Aplicaciones web, SPA, SSR</div>
                                </div>
                                <div class="wizard-option" data-value="mobile">
                                    <div class="wizard-option-icon">📱</div>
                                    <div class="wizard-option-title">Mobile</div>
                                    <div class="wizard-option-desc">iOS, Android, React Native</div>
                                </div>
                                <div class="wizard-option" data-value="desktop">
                                    <div class="wizard-option-icon">🖥️</div>
                                    <div class="wizard-option-title">Desktop</div>
                                    <div class="wizard-option-desc">Electron, apps nativas</div>
                                </div>
                                <div class="wizard-option" data-value="cloud">
                                    <div class="wizard-option-icon">☁️</div>
                                    <div class="wizard-option-title">Cloud/Backend</div>
                                    <div class="wizard-option-desc">APIs, microservicios</div>
                                </div>
                                <div class="wizard-option" data-value="multi">
                                    <div class="wizard-option-icon">🔗</div>
                                    <div class="wizard-option-title">Multi-plataforma</div>
                                    <div class="wizard-option-desc">Varias plataformas</div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 3: Team Size -->
                        <div class="wizard-page" data-page="3">
                            <div class="wizard-options" id="team-options">
                                <div class="wizard-option" data-value="startup">
                                    <div class="wizard-option-icon">🚀</div>
                                    <div class="wizard-option-title">Startup (1-5)</div>
                                    <div class="wizard-option-desc">Equipo pequeno, velocidad maxima</div>
                                </div>
                                <div class="wizard-option" data-value="scaleup">
                                    <div class="wizard-option-icon">📈</div>
                                    <div class="wizard-option-title">Scale-up (6-20)</div>
                                    <div class="wizard-option-desc">Crecimiento, consistencia</div>
                                </div>
                                <div class="wizard-option" data-value="multisquad">
                                    <div class="wizard-option-icon">👥</div>
                                    <div class="wizard-option-title">Multi-squad (21-80)</div>
                                    <div class="wizard-option-desc">Estandarizacion, templates</div>
                                </div>
                                <div class="wizard-option" data-value="enterprise">
                                    <div class="wizard-option-icon">🏢</div>
                                    <div class="wizard-option-title">Enterprise (80+)</div>
                                    <div class="wizard-option-desc">Gobernanza, compliance</div>
                                </div>
                            </div>
                        </div>

                        <!-- Result -->
                        <div class="wizard-result" id="wizard-result">
                            <h3 style="color: var(--success); margin-bottom: 1rem;">Workflow Recomendado</h3>
                            <div class="result-workflow">
                                <div class="result-title" id="result-title"></div>
                                <div class="workflow-flow" id="result-flow"></div>

                                <!-- Journey Agents -->
                                <div class="journey-agents-grid" id="journey-agents"></div>

                                <div class="journey-actions">
                                    <button class="journey-btn journey-btn-primary" id="journey-add-selected">
                                        📦 Agregar Seleccionados al Stack
                                    </button>
                                    <button class="journey-btn journey-btn-secondary" id="journey-open-stack">
                                        Ver Mi Stack →
                                    </button>
                                </div>

                                <div class="workflow-signals" style="margin-top: 1.5rem;">
                                    <div class="workflow-signals-title">Senales para usar este workflow:</div>
                                    <div class="workflow-signals-list" id="result-signals"></div>
                                </div>

                                <div class="journey-templates">
                                    <div class="journey-templates-title">O empieza desde un template</div>
                                    <div class="journey-template-btns">
                                        <button class="journey-template-btn" onclick="loadTemplate('startup-web')">🚀 Startup Web</button>
                                        <button class="journey-template-btn" onclick="loadTemplate('mobile-mvp')">📱 Mobile MVP</button>
                                        <button class="journey-template-btn" onclick="loadTemplate('enterprise')">🏢 Enterprise</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="wizard-nav">
                        <button class="btn btn-secondary" id="prev-btn" disabled onclick="prevStep()">
                            ← Anterior
                        </button>
                        <button class="btn btn-primary" id="next-btn" disabled onclick="nextStep()">
                            Siguiente →
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Workflows Section -->
        <section id="workflows-section" style="background: var(--bg-secondary);">
            <div class="container">
                <div class="section-header">
                    <h2>Workflows Disponibles</h2>
                    <p><span id="workflow-count"></span> flujos de trabajo predefinidos para los escenarios mas comunes</p>
                </div>

                <div class="workflows-grid" id="workflows-container">
                    <!-- Workflows will be injected by JS -->
                </div>
            </div>
        </section>

        <!-- Workflows by Phase Section -->
        <section id="phases-section">
            <div class="container">
                <div class="section-header">
                    <h2>Workflows por Fase de Desarrollo</h2>
                    <p>Encuentra el workflow adecuado según la etapa de tu proyecto</p>
                </div>

                <div class="phases-timeline" id="phases-container">
                    <!-- Phases will be injected by JS -->
                </div>
            </div>
        </section>

        <!-- Kits Section -->
        <section id="kits-section" style="background: var(--bg-secondary);">
            <div class="container">
                <div class="section-header">
                    <h2>Kits por Madurez</h2>
                    <p>Agentes recomendados segun el tamano de tu equipo</p>
                </div>

                <div class="kits-tabs">
                    <button class="kit-tab active" data-kit="startup">Startup (1-5)</button>
                    <button class="kit-tab" data-kit="scaleup">Scale-up (6-20)</button>
                    <button class="kit-tab" data-kit="multisquad">Multi-squad (21-80)</button>
                    <button class="kit-tab" data-kit="enterprise">Enterprise (80+)</button>
                </div>

                <div id="kits-content">
                    <!-- Kits will be injected by JS -->
                </div>
            </div>
        </section>
    </main>

    <!-- Tooltip -->
    <div class="tooltip" id="tooltip">
        <div class="tooltip-title"></div>
        <div class="tooltip-desc"></div>
    </div>

    <!-- Agent Modal -->
    <div class="modal-overlay" id="agent-modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title-wrapper">
                    <div class="modal-icon" id="modal-icon"></div>
                    <div>
                        <div class="modal-title" id="modal-title"></div>
                        <div class="modal-subtitle" id="modal-subtitle"></div>
                    </div>
                </div>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <pre class="modal-config" id="modal-config"></pre>
            </div>
            <div class="modal-footer">
                <button class="copy-btn" id="copy-btn" onclick="copyConfig()">
                    <span class="copy-icon">📋</span>
                    <span class="copy-text">Copiar Configuracion</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p>Agent Workflow Selector - Basado en Claude Code Agent Packs v2.5 ULTRA</p>
        </div>
    </footer>

    <script>
        // ==================== DATA ====================
        // Development phases
        const phases = [
            { id: 'planificacion', name: 'Planificación', icon: '📋', description: 'Discovery, diseño y decisiones técnicas' },
            { id: 'desarrollo', name: 'Desarrollo', icon: '💻', description: 'Implementación de features y código' },
            { id: 'testing', name: 'Testing', icon: '🧪', description: 'QA, pruebas y validación' },
            { id: 'deploy', name: 'Deploy', icon: '🚀', description: 'Release, CI/CD y lanzamiento' },
            { id: 'mantenimiento', name: 'Mantenimiento', icon: '🔧', description: 'Operaciones, SRE y mejora continua' }
        ];

        const workflows = [
            {
                id: 'bug',
                title: 'Bugs y Regresiones',
                icon: '🐛',
                color: 'cat-quality',
                phase: 'testing',
                agents: ['Bug Hunter', 'Test Strategy', 'Refactor & Code Quality', 'CI/CD', 'Observability'],
                signals: ['Incidentes repetidos', 'PRs que rompen otros', 'Falta test regresion']
            },
            {
                id: 'feature',
                title: 'Nueva Feature',
                icon: '✨',
                color: 'cat-development',
                phase: 'desarrollo',
                agents: ['Product-Discovery', 'Architecture', 'Dev (Frontend/Backend)', 'QA', 'CI/CD', 'Observability'],
                signals: ['MVP requerido', 'Requisitos poco claros', 'Riesgo scope creep']
            },
            {
                id: 'debt',
                title: 'Code Quality & Refactoring',
                icon: '🔧',
                color: 'cat-transversal',
                phase: 'mantenimiento',
                agents: ['Refactor & Code Quality', 'Test Strategy', 'DX Agent', 'Architecture'],
                signals: ['Copiar-pegar frecuente', 'PRs grandes', 'Modulos sin limites']
            },
            {
                id: 'performance',
                title: 'Performance/Costos',
                icon: '⚡',
                color: 'cat-cloud',
                phase: 'mantenimiento',
                agents: ['Observability', 'Performance & Efficiency', 'Cloud Architecture', 'Platform/DevOps', 'CI/CD'],
                signals: ['Core Web Vitals bajos', 'Latencia alta', 'Costo cloud creciendo']
            },
            {
                id: 'cicd',
                title: 'CI/CD Lento',
                icon: '🔄',
                color: 'cat-ops',
                phase: 'deploy',
                agents: ['CI/CD Agent', 'Test Strategy', 'DX Agent', 'Cloud Security'],
                signals: ['Pipelines >15min', 'Tests flaky', 'Configs dispares']
            },
            {
                id: 'tech',
                title: 'Seleccion Tecnologia',
                icon: '🔬',
                color: 'cat-architecture',
                phase: 'planificacion',
                agents: ['Technology Critic', 'Architecture', 'Security', 'DX Agent', 'CI/CD templates'],
                signals: ['Framework sprawl', 'Propuestas por moda', 'Stacks dispares']
            },
            {
                id: 'architecture',
                title: 'Arquitectura/Re-arquitectura',
                icon: '🏗️',
                color: 'cat-architecture',
                phase: 'planificacion',
                agents: ['Product/UX', 'Architecture', 'API Contracts', 'Dev', 'QA', 'CI/CD', 'Observability'],
                signals: ['Escalabilidad limitada', 'Integraciones fragiles', 'Nuevo dominio']
            },
            {
                id: 'sre',
                title: 'Confiabilidad/SRE',
                icon: '📊',
                color: 'cat-cloud',
                phase: 'mantenimiento',
                agents: ['Observability', 'SRE', 'Cloud Architecture', 'Platform/DevOps', 'CI/CD'],
                signals: ['MTTR alto', 'Alertas ruidosas', 'Incidentes severos']
            },
            {
                id: 'incident',
                title: 'Incidente Produccion',
                icon: '🚨',
                color: 'cat-ops',
                phase: 'mantenimiento',
                agents: ['Incident Commander', 'Runbook & Operations', 'Postmortem', 'Chaos & Resilience', 'Capacity'],
                signals: ['Servicio caido', 'Degradacion critica', 'Impacto usuarios']
            },
            {
                id: 'compliance',
                title: 'Compliance/Licencias',
                icon: '📋',
                color: 'cat-security',
                phase: 'mantenimiento',
                agents: ['License Reviewer', 'Technology Critic', 'Docs & Knowledge', 'Quality Gatekeeper'],
                signals: ['Auditoria pendiente', 'Dependencias desconocidas', 'Regulacion nueva']
            },
            {
                id: 'api-design',
                title: 'Diseño de APIs',
                icon: '🔌',
                color: 'cat-development',
                phase: 'planificacion',
                agents: ['API Design', 'GraphQL', 'Contract Testing', 'Documentador', 'Security'],
                signals: ['API nueva', 'Integracion third-party', 'Versionado necesario']
            },
            {
                id: 'security-audit',
                title: 'Auditoria Seguridad',
                icon: '🛡️',
                color: 'cat-security',
                phase: 'testing',
                agents: ['Ethical Hacker', 'Threat Modeling', 'Vulnerability Management', 'Authentication', 'Secret Management'],
                signals: ['Pentest requerido', 'Breach detectado', 'Compliance SOC2/ISO']
            },
            {
                id: 'mobile-launch',
                title: 'Lanzamiento Mobile',
                icon: '📱',
                color: 'cat-mobile',
                phase: 'deploy',
                agents: ['Mobile Architecture', 'App Store Optimization', 'Push Notification', 'Mobile CI-CD', 'Mobile QA'],
                signals: ['Nueva app', 'Release mayor', 'Expansion de mercado']
            },
            {
                id: 'data-pipeline',
                title: 'Pipeline de Datos',
                icon: '📈',
                color: 'cat-data',
                phase: 'desarrollo',
                agents: ['Data Pipeline', 'Data Quality', 'ML Ops', 'Database Architect', 'Observability'],
                signals: ['ETL necesario', 'Data warehouse', 'ML en produccion']
            },
            {
                id: 'i18n',
                title: 'Internacionalizacion',
                icon: '🌍',
                color: 'cat-transversal',
                phase: 'desarrollo',
                agents: ['i18n Agent', 'Frontend', 'Mobile UI', 'QA', 'Documentador'],
                signals: ['Nuevo mercado', 'Multi-idioma', 'RTL support']
            },
            {
                id: 'documentation',
                title: 'Documentacion Tecnica',
                icon: '📚',
                color: 'cat-transversal',
                phase: 'desarrollo',
                agents: ['Documentador', 'ADR Agent', 'Docs & Knowledge', 'API Design', 'Onboarding'],
                signals: ['Docs desactualizados', 'Nuevo equipo', 'API publica']
            },
            {
                id: 'dev-onboarding',
                title: 'Onboarding Devs',
                icon: '👋',
                color: 'cat-transversal',
                phase: 'planificacion',
                agents: ['Onboarding', 'Documentador', 'DX Agent', 'Code Review', 'Configuration Management'],
                signals: ['Nuevo developer', 'Rotacion alta', 'Setup complejo']
            },
            {
                id: 'migration',
                title: 'Migracion Sistema',
                icon: '🚚',
                color: 'cat-architecture',
                phase: 'deploy',
                agents: ['Migration', 'Monolith to Microservices', 'Database Architect', 'Feature Flag', 'Test Strategy'],
                signals: ['Legacy system', 'Cloud migration', 'Database change']
            },
            {
                id: 'testing-strategy',
                title: 'Estrategia Testing',
                icon: '🧪',
                color: 'cat-quality',
                phase: 'testing',
                agents: ['Test Strategy', 'E2E Testing', 'Contract Testing', 'Load Testing', 'Visual Regression'],
                signals: ['Cobertura baja', 'Tests flaky', 'Sin integracion']
            },
            {
                id: 'realtime',
                title: 'Features Real-time',
                icon: '⚡',
                color: 'cat-development',
                phase: 'desarrollo',
                agents: ['WebSocket & Real-time', 'Message Queue', 'Event-Driven Architecture', 'Caching Strategy', 'Observability'],
                signals: ['Chat/colaboracion', 'Notificaciones live', 'Datos en tiempo real']
            },
            {
                id: 'client-server',
                title: 'Arquitectura Cliente-Servidor',
                icon: '🔗',
                color: 'cat-architecture',
                phase: 'planificacion',
                agents: ['Client-Server Architecture', 'API Gateway', 'Load Balancer & Scaling', 'Session & State Management', 'Request-Response Pattern'],
                signals: ['Nueva app distribuida', 'Multiples clientes', 'Escalabilidad requerida']
            },
            {
                id: 'api-infrastructure',
                title: 'Infraestructura de APIs',
                icon: '🌐',
                color: 'cat-architecture',
                phase: 'planificacion',
                agents: ['API Gateway', 'Load Balancer & Scaling', 'Request-Response Pattern', 'Contract Testing', 'Observability'],
                signals: ['API publica', 'Rate limiting necesario', 'Multiples consumidores']
            },
            {
                id: 'high-availability',
                title: 'Alta Disponibilidad',
                icon: '🛡️',
                color: 'cat-cloud',
                phase: 'deploy',
                agents: ['Load Balancer & Scaling', 'Session & State Management', 'Database Architect', 'Chaos & Resilience', 'SRE'],
                signals: ['SLA 99.9%+', 'Sistema critico', 'Zero downtime requerido']
            },
            {
                id: 'distributed-auth',
                title: 'Autenticacion Distribuida',
                icon: '🔐',
                color: 'cat-security',
                phase: 'planificacion',
                agents: ['Session & State Management', 'Authentication', 'API Gateway', 'Client-Server Architecture', 'Security'],
                signals: ['SSO requerido', 'Multi-tenant', 'OAuth/OIDC necesario']
            },
            {
                id: 'growth-monetization',
                title: 'Growth & Monetizacion',
                icon: '💰',
                color: 'cat-transversal',
                phase: 'desarrollo',
                agents: ['Monetization Strategy', 'Marketing Campaigns', 'Data & Analytics', 'Product-Discovery', 'Observability'],
                signals: ['Revenue estancado', 'Baja conversion', 'Lanzamiento de producto', 'Expansion de mercado']
            },
            {
                id: 'product-launch',
                title: 'Lanzamiento de Producto',
                icon: '🚀',
                color: 'cat-transversal',
                phase: 'deploy',
                agents: ['Marketing Campaigns', 'Monetization Strategy', 'Product-Discovery', 'Observability', 'Data & Analytics'],
                signals: ['Nuevo producto', 'Nueva feature premium', 'Entrada a mercado', 'Rebranding']
            },
            {
                id: 'user-retention',
                title: 'Retencion de Usuarios',
                icon: '🎯',
                color: 'cat-transversal',
                phase: 'mantenimiento',
                agents: ['Marketing Campaigns', 'Monetization Strategy', 'Data & Analytics', 'Observability', 'DX Agent'],
                signals: ['Churn alto', 'Usuarios inactivos', 'Baja engagement', 'Competencia agresiva']
            },
            {
                id: 'platform-evolution',
                title: 'Evolucion de Plataforma',
                icon: '🔄',
                color: 'cat-architecture',
                phase: 'planificacion',
                agents: ['Platform Evolution Strategy', 'Architecture', 'Migration', 'Client-Server Architecture', 'Database Architect'],
                signals: ['Desktop sin version mobile', 'Monolito limitante', 'Expansion multi-plataforma', 'Modernizacion legacy']
            },
            {
                id: 'desktop-to-cloud',
                title: 'Desktop a Cliente-Servidor',
                icon: '☁️',
                color: 'cat-cloud',
                phase: 'planificacion',
                agents: ['Platform Evolution Strategy', 'Client-Server Architecture', 'API Gateway', 'Cloud Architecture', 'Database Architect'],
                signals: ['App desktop exitosa', 'Usuarios remotos', 'Necesidad de colaboracion', 'Escalabilidad requerida']
            },
            {
                id: 'expand-to-mobile',
                title: 'Expansion a Mobile',
                icon: '📱',
                color: 'cat-mobile',
                phase: 'planificacion',
                agents: ['Platform Evolution Strategy', 'Mobile Architecture', 'API Gateway', 'Mobile UI', 'Mobile QA'],
                signals: ['Usuarios moviles', 'Competencia con app', 'Acceso offline necesario', 'Push notifications']
            },
            {
                id: 'saas-billing',
                title: 'Setup Billing SaaS',
                icon: '💳',
                color: 'cat-transversal',
                phase: 'desarrollo',
                agents: ['Billing & Invoicing', 'Payment Gateway', 'Notification Engine', 'Multi-tenant SaaS', 'Database Architect'],
                signals: ['Nuevo SaaS', 'Modelo suscripcion', 'Pagos recurrentes', 'Facturacion automatica']
            },
            {
                id: 'multitenant-architecture',
                title: 'Arquitectura Multi-tenant',
                icon: '🏢',
                color: 'cat-architecture',
                phase: 'planificacion',
                agents: ['Multi-tenant SaaS', 'Domain-Driven Design', 'Cloud Architecture', 'Database Architect', 'Security'],
                signals: ['SaaS B2B', 'Aislamiento datos', 'Configuracion por cliente', 'Compliance multi-tenant']
            }
        ];

        // __AGENTS_DATA_PLACEHOLDER__


        // Sistema de keywords semánticas para búsqueda inteligente
        const searchKeywords = {
            // Performance y optimización
            'rapidez': ['Performance & Efficiency Agent', 'Refactor & Code Quality Agent', 'SRE Agent', 'Platform-DevOps Agent'],
            'optimizacion': ['Performance & Efficiency Agent', 'Refactor & Code Quality Agent', 'Capacity & Cost Governance Agent', 'SRE Agent'],
            'velocidad': ['Performance & Efficiency Agent', 'Refactor & Code Quality Agent', 'Web CI-CD Agent', 'Mobile CI-CD Agent'],
            'performance': ['Performance & Efficiency Agent', 'SRE Agent', 'Observability Agent', 'Capacity & Cost Governance Agent'],
            'rendimiento': ['Performance & Efficiency Agent', 'SRE Agent', 'Observability Agent'],
            'lento': ['Performance & Efficiency Agent', 'Refactor & Code Quality Agent', 'Observability Agent'],
            'memoria': ['Performance & Efficiency Agent', 'Bug Hunter Agent', 'Observability Agent'],
            'cache': ['Performance & Efficiency Agent', 'Web BFF-Backend Agent', 'Cloud Architecture Agent'],

            // Seguridad y hacking
            'hacking': ['Ethical Hacker & PenTest Advisor Agent', 'Threat Modeling Agent', 'Security Testing Integrator Agent', 'Cloud Security Agent', 'Mobile Security Agent'],
            'seguridad': ['Ethical Hacker & PenTest Advisor Agent', 'Threat Modeling Agent', 'Security Testing Integrator Agent', 'Cloud Security Agent', 'Mobile Security Agent', 'License Reviewer & OSS Alternatives Agent'],
            'security': ['Ethical Hacker & PenTest Advisor Agent', 'Threat Modeling Agent', 'Security Testing Integrator Agent', 'Cloud Security Agent', 'Mobile Security Agent'],
            'pentest': ['Ethical Hacker & PenTest Advisor Agent', 'Security Testing Integrator Agent'],
            'vulnerabilidad': ['Ethical Hacker & PenTest Advisor Agent', 'Threat Modeling Agent', 'Security Testing Integrator Agent', 'Bug Hunter Agent'],
            'owasp': ['Ethical Hacker & PenTest Advisor Agent', 'Security Testing Integrator Agent', 'Web BFF-Backend Agent'],
            'xss': ['Ethical Hacker & PenTest Advisor Agent', 'Security Testing Integrator Agent', 'Frontend Web Agent'],
            'sql injection': ['Ethical Hacker & PenTest Advisor Agent', 'Security Testing Integrator Agent', 'Web BFF-Backend Agent'],
            'amenaza': ['Threat Modeling Agent', 'Ethical Hacker & PenTest Advisor Agent'],
            'cifrado': ['Cloud Security Agent', 'Mobile Security Agent', 'Ethical Hacker & PenTest Advisor Agent'],
            'autenticacion': ['Cloud Security Agent', 'Web BFF-Backend Agent', 'Mobile Security Agent'],

            // Testing y QA
            'testing': ['Test Strategy Agent', 'Bug Hunter Agent', 'Web QA Agent', 'Mobile QA Agent', 'Quality Gatekeeper Agent', 'Security Testing Integrator Agent'],
            'test': ['Test Strategy Agent', 'Bug Hunter Agent', 'Web QA Agent', 'Mobile QA Agent', 'Quality Gatekeeper Agent'],
            'pruebas': ['Test Strategy Agent', 'Bug Hunter Agent', 'Web QA Agent', 'Mobile QA Agent', 'Quality Gatekeeper Agent'],
            'qa': ['Web QA Agent', 'Mobile QA Agent', 'Quality Gatekeeper Agent', 'Test Strategy Agent'],
            'calidad': ['Quality Gatekeeper Agent', 'Test Strategy Agent', 'Refactor & Code Quality Agent', 'Bug Hunter Agent'],
            'bug': ['Bug Hunter Agent', 'Test Strategy Agent', 'Quality Gatekeeper Agent'],
            'error': ['Bug Hunter Agent', 'Observability Agent', 'Incident Commander Agent'],
            'cobertura': ['Test Strategy Agent', 'Quality Gatekeeper Agent'],
            'unitario': ['Test Strategy Agent', 'Bug Hunter Agent'],
            'integracion': ['Test Strategy Agent', 'Desktop Integration Agent', 'Security Testing Integrator Agent'],
            'e2e': ['Test Strategy Agent', 'Web QA Agent', 'Mobile QA Agent'],

            // Documentación
            'documentacion': ['Documentador Agent', 'Docs & Knowledge Agent', 'Release Manager Agent'],
            'documentador': ['Documentador Agent', 'Docs & Knowledge Agent'],
            'readme': ['Documentador Agent', 'Docs & Knowledge Agent'],
            'docs': ['Documentador Agent', 'Docs & Knowledge Agent', 'Release Manager Agent'],
            'adr': ['Documentador Agent', 'Docs & Knowledge Agent'],
            'conocimiento': ['Docs & Knowledge Agent', 'Postmortem & Learning Agent'],
            'wiki': ['Docs & Knowledge Agent', 'Documentador Agent'],
            'guia': ['Documentador Agent', 'Docs & Knowledge Agent', 'Runbook & Operations Agent'],

            // Arquitectura
            'arquitectura': ['Web Architecture Agent', 'Mobile Architecture Agent', 'Desktop Architecture Agent', 'Cloud Architecture Agent', 'Technology Critic & Improvement Agent'],
            'architecture': ['Web Architecture Agent', 'Mobile Architecture Agent', 'Desktop Architecture Agent', 'Cloud Architecture Agent'],
            'diseño': ['Web Architecture Agent', 'Mobile Architecture Agent', 'Design System Steward Agent', 'Threat Modeling Agent'],
            'modular': ['Web Architecture Agent', 'Mobile Architecture Agent', 'Refactor & Code Quality Agent'],
            'microservicios': ['Cloud Architecture Agent', 'Web BFF-Backend Agent', 'Platform-DevOps Agent'],
            'monolito': ['Cloud Architecture Agent', 'Refactor & Code Quality Agent'],
            'patron': ['Web Architecture Agent', 'Refactor & Code Quality Agent', 'Design System Steward Agent'],

            // DevOps y CI/CD
            'devops': ['Platform-DevOps Agent', 'GitOps CI-CD Agent', 'Web CI-CD Agent', 'Mobile CI-CD Agent', 'Desktop CI-CD Agent'],
            'cicd': ['GitOps CI-CD Agent', 'Web CI-CD Agent', 'Mobile CI-CD Agent', 'Desktop CI-CD Agent'],
            'ci/cd': ['GitOps CI-CD Agent', 'Web CI-CD Agent', 'Mobile CI-CD Agent', 'Desktop CI-CD Agent'],
            'pipeline': ['GitOps CI-CD Agent', 'Web CI-CD Agent', 'Mobile CI-CD Agent', 'Platform-DevOps Agent'],
            'deploy': ['GitOps CI-CD Agent', 'Platform-DevOps Agent', 'Release Manager Agent', 'SRE Agent'],
            'despliegue': ['GitOps CI-CD Agent', 'Platform-DevOps Agent', 'Release Manager Agent'],
            'kubernetes': ['Platform-DevOps Agent', 'Cloud Architecture Agent', 'SRE Agent'],
            'docker': ['Platform-DevOps Agent', 'Cloud Architecture Agent', 'GitOps CI-CD Agent'],
            'terraform': ['Platform-DevOps Agent', 'Cloud Architecture Agent'],
            'infraestructura': ['Platform-DevOps Agent', 'Cloud Architecture Agent', 'SRE Agent'],

            // Observabilidad y monitoreo
            'monitoreo': ['Observability Agent', 'SRE Agent', 'Incident Commander Agent'],
            'logs': ['Observability Agent', 'SRE Agent', 'Bug Hunter Agent'],
            'metricas': ['Observability Agent', 'SRE Agent', 'Data & Analytics Agent', 'Capacity & Cost Governance Agent'],
            'alertas': ['Observability Agent', 'SRE Agent', 'Incident Commander Agent'],
            'tracing': ['Observability Agent', 'Performance & Efficiency Agent'],
            'dashboard': ['Observability Agent', 'Data & Analytics Agent'],

            // Incidentes y operaciones
            'incidente': ['Incident Commander Agent', 'Postmortem & Learning Agent', 'Runbook & Operations Agent', 'SRE Agent'],
            'postmortem': ['Postmortem & Learning Agent', 'Incident Commander Agent', 'Docs & Knowledge Agent'],
            'runbook': ['Runbook & Operations Agent', 'SRE Agent', 'Incident Commander Agent'],
            'on-call': ['Incident Commander Agent', 'Runbook & Operations Agent', 'SRE Agent'],
            'escalamiento': ['Incident Commander Agent', 'SRE Agent'],
            'recuperacion': ['Incident Commander Agent', 'Chaos & Resilience Agent', 'SRE Agent'],
            'disaster': ['Chaos & Resilience Agent', 'SRE Agent', 'Cloud Architecture Agent'],

            // Resiliencia y chaos
            'resiliencia': ['Chaos & Resilience Agent', 'SRE Agent', 'Cloud Architecture Agent'],
            'chaos': ['Chaos & Resilience Agent', 'SRE Agent'],
            'fallback': ['Chaos & Resilience Agent', 'Web BFF-Backend Agent', 'SRE Agent'],
            'retry': ['Chaos & Resilience Agent', 'Web BFF-Backend Agent'],
            'circuit breaker': ['Chaos & Resilience Agent', 'Web BFF-Backend Agent'],

            // Costos
            'costo': ['Capacity & Cost Governance Agent', 'Cloud Architecture Agent', 'Technology Critic & Improvement Agent'],
            'presupuesto': ['Capacity & Cost Governance Agent'],
            'ahorro': ['Capacity & Cost Governance Agent', 'Performance & Efficiency Agent'],
            'finops': ['Capacity & Cost Governance Agent', 'Cloud Architecture Agent'],

            // Frontend y UI
            'frontend': ['Frontend Web Agent', 'Mobile UI Agent', 'Design System Steward Agent', 'Web Accessibility Agent'],
            'ui': ['Frontend Web Agent', 'Mobile UI Agent', 'Design System Steward Agent'],
            'ux': ['Frontend Web Agent', 'Mobile UI Agent', 'Web Product-Discovery Agent', 'Web Accessibility Agent'],
            'componentes': ['Frontend Web Agent', 'Design System Steward Agent', 'Mobile UI Agent'],
            'react': ['Frontend Web Agent', 'Design System Steward Agent'],
            'css': ['Frontend Web Agent', 'Design System Steward Agent', 'Web Accessibility Agent'],
            'accesibilidad': ['Web Accessibility Agent', 'Frontend Web Agent', 'Mobile UI Agent'],
            'a11y': ['Web Accessibility Agent', 'Frontend Web Agent'],
            'responsive': ['Frontend Web Agent', 'Mobile UI Agent', 'Web Accessibility Agent'],

            // Backend y API
            'backend': ['Web BFF-Backend Agent', 'Cloud Architecture Agent', 'Platform-DevOps Agent'],
            'api': ['Web BFF-Backend Agent', 'Cloud Architecture Agent', 'Documentador Agent'],
            'bff': ['Web BFF-Backend Agent'],
            'rest': ['Web BFF-Backend Agent', 'Documentador Agent'],
            'graphql': ['Web BFF-Backend Agent', 'Cloud Architecture Agent'],
            'base de datos': ['Web BFF-Backend Agent', 'Cloud Architecture Agent', 'Performance & Efficiency Agent'],
            'sql': ['Web BFF-Backend Agent', 'Ethical Hacker & PenTest Advisor Agent'],

            // Mobile
            'mobile': ['Mobile Architecture Agent', 'Mobile UI Agent', 'Mobile Data Agent', 'Mobile QA Agent', 'Mobile CI-CD Agent', 'Mobile Security Agent'],
            'android': ['Mobile Architecture Agent', 'Mobile UI Agent', 'Mobile CI-CD Agent'],
            'ios': ['Mobile Architecture Agent', 'Mobile UI Agent', 'Mobile CI-CD Agent'],
            'app': ['Mobile Architecture Agent', 'Mobile UI Agent', 'Mobile Data Agent'],
            'offline': ['Mobile Data Agent', 'Mobile Architecture Agent'],

            // Desktop
            'desktop': ['Desktop Architecture Agent', 'Desktop Integration Agent', 'Desktop CI-CD Agent'],
            'electron': ['Desktop Architecture Agent', 'Desktop Integration Agent'],
            'nativo': ['Desktop Architecture Agent', 'Mobile Architecture Agent'],

            // Analytics y datos
            'analytics': ['Data & Analytics Agent', 'Observability Agent', 'Web Product-Discovery Agent'],
            'datos': ['Data & Analytics Agent', 'Mobile Data Agent', 'Observability Agent'],
            'eventos': ['Data & Analytics Agent', 'Observability Agent'],
            'tracking': ['Data & Analytics Agent', 'Web Product-Discovery Agent'],
            'metricas negocio': ['Data & Analytics Agent', 'Web Product-Discovery Agent'],

            // Producto
            'producto': ['Web Product-Discovery Agent', 'Technology Critic & Improvement Agent', 'Release Manager Agent'],
            'discovery': ['Web Product-Discovery Agent', 'Technology Critic & Improvement Agent'],
            'feature': ['Web Product-Discovery Agent', 'Release Manager Agent', 'Quality Gatekeeper Agent'],
            'release': ['Release Manager Agent', 'GitOps CI-CD Agent', 'Quality Gatekeeper Agent'],
            'version': ['Release Manager Agent', 'GitOps CI-CD Agent'],
            'changelog': ['Release Manager Agent', 'Documentador Agent'],

            // Refactoring y código
            'refactor': ['Refactor & Code Quality Agent', 'Technology Critic & Improvement Agent', 'Bug Hunter Agent'],
            'codigo': ['Refactor & Code Quality Agent', 'Bug Hunter Agent', 'Quality Gatekeeper Agent'],
            'deuda tecnica': ['Refactor & Code Quality Agent', 'Technology Critic & Improvement Agent'],
            'clean code': ['Refactor & Code Quality Agent', 'Quality Gatekeeper Agent'],
            'solid': ['Refactor & Code Quality Agent', 'Web Architecture Agent'],
            'duplicado': ['Refactor & Code Quality Agent', 'Bug Hunter Agent'],

            // Licencias y legal
            'licencia': ['License Reviewer & OSS Alternatives Agent'],
            'open source': ['License Reviewer & OSS Alternatives Agent', 'Technology Critic & Improvement Agent'],
            'dependencia': ['License Reviewer & OSS Alternatives Agent', 'Technology Critic & Improvement Agent'],
            'legal': ['License Reviewer & OSS Alternatives Agent'],

            // Design System
            'design system': ['Design System Steward Agent', 'Frontend Web Agent'],
            'tokens': ['Design System Steward Agent', 'Frontend Web Agent'],
            'estilo': ['Design System Steward Agent', 'Frontend Web Agent', 'Refactor & Code Quality Agent'],

            // Condo específicos
            'condo': ['Financial Rules & Billing Agent', 'Payments Integration & Reconciliation Agent', 'Residents Portal Agent', 'Condo Mobile Resident Agent', 'Admin Dashboard Agent', 'Notifications & Comms Agent'],
            'gastos comunes': ['Financial Rules & Billing Agent'],
            'pagos': ['Payments Integration & Reconciliation Agent', 'Financial Rules & Billing Agent'],
            'residentes': ['Residents Portal Agent', 'Condo Mobile Resident Agent', 'Notifications & Comms Agent'],
            'condominio': ['Financial Rules & Billing Agent', 'Payments Integration & Reconciliation Agent', 'Residents Portal Agent'],
            'facturacion': ['Financial Rules & Billing Agent', 'Payments Integration & Reconciliation Agent'],
            'conciliacion': ['Payments Integration & Reconciliation Agent'],

            // Database
            'database': ['Database Architect Agent', 'Cloud Architecture Agent', 'Web BFF-Backend Agent'],
            'base de datos': ['Database Architect Agent', 'Cloud Architecture Agent', 'Web BFF-Backend Agent'],
            'schema': ['Database Architect Agent', 'API Design Agent'],
            'indexacion': ['Database Architect Agent', 'Performance & Efficiency Agent'],
            'sharding': ['Database Architect Agent', 'Cloud Architecture Agent'],
            'backup': ['Database Architect Agent', 'SRE Agent', 'Cloud Architecture Agent'],
            'recovery': ['Database Architect Agent', 'Incident Commander Agent', 'Chaos & Resilience Agent'],
            'migration': ['Database Architect Agent', 'Release Manager Agent'],

            // FinOps & Cost Optimization
            'finops': ['FinOps & Cost Agent', 'Capacity & Cost Governance Agent', 'Cloud Architecture Agent'],
            'rightsizing': ['FinOps & Cost Agent', 'Capacity & Cost Governance Agent'],
            'savings': ['FinOps & Cost Agent', 'Capacity & Cost Governance Agent'],
            'budget': ['FinOps & Cost Agent', 'Capacity & Cost Governance Agent'],
            'tagging': ['FinOps & Cost Agent', 'Cloud Architecture Agent'],
            'alternativas': ['FinOps & Cost Agent', 'Technology Critic & Improvement Agent'],
            'roi': ['FinOps & Cost Agent', 'Monetization Strategy Agent'],
            'tco': ['FinOps & Cost Agent', 'Technology Critic & Improvement Agent'],
            'comparar precios': ['FinOps & Cost Agent'],
            'economico': ['FinOps & Cost Agent', 'Capacity & Cost Governance Agent'],
            'barato': ['FinOps & Cost Agent'],
            'optimizar costos': ['FinOps & Cost Agent', 'Capacity & Cost Governance Agent'],
            'reducir gastos': ['FinOps & Cost Agent', 'Capacity & Cost Governance Agent'],

            // API Design
            'api design': ['API Design Agent', 'Web BFF-Backend Agent'],
            'openapi': ['API Design Agent', 'Documentador Agent'],
            'swagger': ['API Design Agent', 'Documentador Agent'],
            'grpc': ['API Design Agent', 'Cloud Architecture Agent'],
            'versionado': ['API Design Agent', 'Release Manager Agent'],
            'contract': ['API Design Agent', 'Test Strategy Agent'],

            // Compliance
            'compliance': ['Compliance Agent', 'Cloud Security Agent', 'License Reviewer & OSS Alternatives Agent'],
            'gdpr': ['Compliance Agent', 'Cloud Security Agent'],
            'ccpa': ['Compliance Agent', 'Cloud Security Agent'],
            'hipaa': ['Compliance Agent', 'Cloud Security Agent'],
            'pci': ['Compliance Agent', 'Cloud Security Agent'],
            'soc2': ['Compliance Agent', 'Cloud Security Agent'],
            'regulacion': ['Compliance Agent', 'License Reviewer & OSS Alternatives Agent'],
            'auditoria': ['Compliance Agent', 'Cloud Security Agent', 'Observability Agent'],
            'privacidad': ['Compliance Agent', 'Cloud Security Agent', 'Threat Modeling Agent'],
            'retencion': ['Compliance Agent', 'Database Architect Agent'],

            // Technical Debt
            'deuda': ['Technical Debt Agent', 'Refactor & Code Quality Agent'],
            'debt': ['Technical Debt Agent', 'Refactor & Code Quality Agent'],
            'legacy': ['Technical Debt Agent', 'Refactor & Code Quality Agent', 'Technology Critic & Improvement Agent'],
            'tech debt': ['Technical Debt Agent', 'Refactor & Code Quality Agent'],

            // i18n
            'i18n': ['i18n Agent', 'Frontend Web Agent', 'Mobile UI Agent'],
            'l10n': ['i18n Agent', 'Frontend Web Agent'],
            'traduccion': ['i18n Agent', 'Documentador Agent'],
            'idioma': ['i18n Agent', 'Frontend Web Agent'],
            'locale': ['i18n Agent', 'Frontend Web Agent'],
            'rtl': ['i18n Agent', 'Frontend Web Agent', 'Web Accessibility Agent'],
            'internacionalizacion': ['i18n Agent', 'Frontend Web Agent'],
            'localizacion': ['i18n Agent', 'Frontend Web Agent'],
            // ========== KEYWORDS FOR NEW AGENTS ==========
            // Architecture
            'clean architecture': ['Clean Architecture Agent', 'Refactor & Code Quality Agent'],
            'ddd': ['Domain-Driven Design Agent', 'Clean Architecture Agent'],
            'domain driven': ['Domain-Driven Design Agent', 'Clean Architecture Agent'],
            'bounded context': ['Domain-Driven Design Agent', 'Microservices Agent'],
            'event driven': ['Event-Driven Architecture Agent', 'Message Queue Agent'],
            'event sourcing': ['Event-Driven Architecture Agent', 'Database Architect Agent'],
            'cqrs': ['Event-Driven Architecture Agent', 'Database Architect Agent'],
            'saga': ['Event-Driven Architecture Agent', 'Message Queue Agent'],
            'strangler': ['Monolith to Microservices Agent', 'Migration Agent'],
            // Backend
            'redis': ['Caching Strategy Agent', 'Message Queue Agent', 'WebSocket & Real-time Agent'],
            'graphql': ['GraphQL Agent', 'API Design Agent'],
            'dataloader': ['GraphQL Agent', 'Performance & Efficiency Agent'],
            'queue': ['Message Queue Agent', 'Event-Driven Architecture Agent'],
            'kafka': ['Message Queue Agent', 'Event-Driven Architecture Agent'],
            'rabbitmq': ['Message Queue Agent', 'Event-Driven Architecture Agent'],
            'elasticsearch': ['Search Engine Agent', 'Observability Agent'],
            'websocket': ['WebSocket & Real-time Agent', 'Frontend Web Agent'],
            'real-time': ['WebSocket & Real-time Agent', 'Push Notification Agent'],
            'socket': ['WebSocket & Real-time Agent', 'Message Queue Agent'],
            // Cloud & DevOps
            'multicloud': ['Multi-Cloud Agent', 'Cloud Architecture Agent'],
            'serverless': ['Serverless Agent', 'Cloud Architecture Agent', 'FinOps & Cost Agent'],
            'lambda': ['Serverless Agent', 'Cloud Architecture Agent'],
            'cdn': ['CDN Agent', 'Performance & Efficiency Agent', 'Caching Strategy Agent'],
            'container': ['Container Orchestration Agent', 'Platform-DevOps Agent'],
            'iac': ['Infrastructure as Code Agent', 'Platform-DevOps Agent'],
            'pulumi': ['Infrastructure as Code Agent', 'Cloud Architecture Agent'],
            'service mesh': ['Service Mesh Agent', 'Microservices Agent'],
            'istio': ['Service Mesh Agent', 'Microservices Agent'],
            // Data
            'etl': ['Data Pipeline Agent', 'Data Quality Agent'],
            'data pipeline': ['Data Pipeline Agent', 'Data Quality Agent'],
            'data quality': ['Data Quality Agent', 'Data Pipeline Agent'],
            'mlops': ['ML Ops Agent', 'Data Pipeline Agent'],
            'machine learning': ['ML Ops Agent', 'Data Pipeline Agent'],
            // Integrations
            'smtp': ['Email Delivery Agent', 'Notification Hub Agent'],
            'sendgrid': ['Email Delivery Agent', 'Third-Party Integration Agent'],
            'file storage': ['File Storage Agent', 'Cloud Architecture Agent'],
            's3': ['File Storage Agent', 'Cloud Architecture Agent'],
            'stripe': ['Payment Integration Agent', 'Third-Party Integration Agent'],
            'webhook': ['Third-Party Integration Agent', 'API Design Agent'],
            // Mobile
            'aso': ['App Store Optimization Agent', 'Mobile Architecture Agent'],
            'app store': ['App Store Optimization Agent', 'Mobile CI-CD Agent'],
            'deep link': ['Deep Linking Agent', 'Mobile Architecture Agent'],
            'universal link': ['Deep Linking Agent', 'Mobile Architecture Agent'],
            'firebase': ['Push Notification Agent', 'Mobile Architecture Agent'],
            // Security
            'oauth': ['Authentication Agent', 'API Design Agent'],
            'jwt': ['Authentication Agent', 'Authorization Agent'],
            'rbac': ['Authorization Agent', 'Authentication Agent'],
            'permissions': ['Authorization Agent', 'Authentication Agent'],
            'vault': ['Secret Management Agent', 'Platform-DevOps Agent'],
            'cve': ['Vulnerability Management Agent', 'Security Testing Integrator Agent'],
            // Testing
            'ab test': ['A-B Testing Agent', 'Feature Flag Agent'],
            'experiment': ['A-B Testing Agent', 'Feature Flag Agent'],
            'contract test': ['Contract Testing Agent', 'API Design Agent'],
            'pact': ['Contract Testing Agent', 'Test Strategy Agent'],
            'cypress': ['E2E Testing Agent', 'Web QA Agent'],
            'playwright': ['E2E Testing Agent', 'Web QA Agent'],
            'load test': ['Load Testing Agent', 'Performance & Efficiency Agent'],
            'stress test': ['Load Testing Agent', 'Chaos & Resilience Agent'],
            'k6': ['Load Testing Agent', 'Performance & Efficiency Agent'],
            'mutation test': ['Mutation Testing Agent', 'Test Strategy Agent'],
            'visual regression': ['Visual Regression Agent', 'Web QA Agent'],
            'screenshot': ['Visual Regression Agent', 'E2E Testing Agent'],
            // Transversal
            'code review': ['Code Review Agent', 'Refactor & Code Quality Agent'],
            'pr review': ['Code Review Agent', 'Quality Gatekeeper Agent'],
            'environment': ['Configuration Management Agent', 'Platform-DevOps Agent'],
            'error handling': ['Error Handling Agent', 'Bug Hunter Agent'],
            'exception': ['Error Handling Agent', 'Observability Agent'],
            'feature flag': ['Feature Flag Agent', 'A-B Testing Agent'],
            'toggle': ['Feature Flag Agent', 'Release Manager Agent'],
            'launchdarkly': ['Feature Flag Agent', 'A-B Testing Agent'],
            'structured log': ['Logging Strategy Agent', 'Observability Agent'],
            'tech radar': ['Technology Radar Agent', 'Technology Critic & Improvement Agent'],
            // Web
            'animation': ['Animation & Motion Agent', 'Frontend Web Agent'],
            'motion': ['Animation & Motion Agent', 'Frontend Web Agent'],
            'framer': ['Animation & Motion Agent', 'Frontend Web Agent'],
            'css architecture': ['CSS Architecture Agent', 'Frontend Web Agent'],
            'bem': ['CSS Architecture Agent', 'Design System Steward Agent'],
            'tailwind': ['CSS Architecture Agent', 'Frontend Web Agent'],
            'micro frontend': ['Micro-Frontend Agent', 'Web Architecture Agent'],
            'module federation': ['Micro-Frontend Agent', 'Web Architecture Agent'],
            'service worker': ['PWA Agent', 'Caching Strategy Agent'],
            'mobile first': ['Responsive Design Agent', 'Mobile Architecture Agent'],
            'state management': ['State Management Agent', 'Frontend Web Agent'],
            'redux': ['State Management Agent', 'Frontend Web Agent'],
            // Languages & Technologies
            'python': ['Python Agent', 'Data Pipeline Agent', 'ML Ops Agent'],
            'django': ['Python Agent', 'Web BFF-Backend Agent'],
            'fastapi': ['Python Agent', 'API Design Agent'],
            'flask': ['Python Agent', 'Web BFF-Backend Agent'],
            'pytest': ['Python Agent', 'Test Strategy Agent'],
            'csharp': ['C# .NET Agent', 'Desktop Architecture Agent'],
            'c#': ['C# .NET Agent', 'Desktop Architecture Agent'],
            '.net': ['C# .NET Agent', 'Cloud Architecture Agent'],
            'dotnet': ['C# .NET Agent', 'Cloud Architecture Agent'],
            'aspnet': ['C# .NET Agent', 'Web BFF-Backend Agent'],
            'blazor': ['C# .NET Agent', 'Frontend Web Agent'],
            'maui': ['C# .NET Agent', 'Mobile Architecture Agent'],
            'delphi': ['Delphi Agent', 'Desktop Architecture Agent'],
            'pascal': ['Delphi Agent', 'Desktop Architecture Agent'],
            'firemonkey': ['Delphi Agent', 'Mobile Architecture Agent'],
            'vcl': ['Delphi Agent', 'Desktop Architecture Agent'],
            'java': ['Java Agent', 'Cloud Architecture Agent'],
            'spring': ['Java Agent', 'Web BFF-Backend Agent'],
            'spring boot': ['Java Agent', 'Cloud Architecture Agent'],
            'hibernate': ['Java Agent', 'Database Architect Agent'],
            'maven': ['Java Agent', 'Web CI-CD Agent'],
            'gradle': ['Java Agent', 'Kotlin Agent', 'Mobile CI-CD Agent'],
            'quarkus': ['Java Agent', 'Cloud Architecture Agent'],
            'golang': ['Go Agent', 'Cloud Architecture Agent'],
            'go': ['Go Agent', 'Platform-DevOps Agent'],
            'gin': ['Go Agent', 'Web BFF-Backend Agent'],
            'goroutine': ['Go Agent', 'Performance & Efficiency Agent'],
            'rust': ['Rust Agent', 'Performance & Efficiency Agent'],
            'cargo': ['Rust Agent'],
            'tokio': ['Rust Agent', 'Performance & Efficiency Agent'],
            'axum': ['Rust Agent', 'Web BFF-Backend Agent'],
            'actix': ['Rust Agent', 'Web BFF-Backend Agent'],
            'typescript': ['TypeScript Node.js Agent', 'Frontend Web Agent'],
            'nodejs': ['TypeScript Node.js Agent', 'Web BFF-Backend Agent'],
            'node': ['TypeScript Node.js Agent', 'Web BFF-Backend Agent'],
            'express': ['TypeScript Node.js Agent', 'Web BFF-Backend Agent'],
            'fastify': ['TypeScript Node.js Agent', 'Web BFF-Backend Agent'],
            'nestjs': ['TypeScript Node.js Agent', 'Web BFF-Backend Agent'],
            'prisma': ['TypeScript Node.js Agent', 'Database Architect Agent'],
            'bun': ['TypeScript Node.js Agent', 'Performance & Efficiency Agent'],
            'deno': ['TypeScript Node.js Agent'],
            'php': ['PHP Agent', 'Web BFF-Backend Agent'],
            'laravel': ['PHP Agent', 'Web BFF-Backend Agent'],
            'symfony': ['PHP Agent', 'Web BFF-Backend Agent'],
            'composer': ['PHP Agent'],
            'eloquent': ['PHP Agent', 'Database Architect Agent'],
            'ruby': ['Ruby Agent', 'Web BFF-Backend Agent'],
            'rails': ['Ruby Agent', 'Web BFF-Backend Agent'],
            'ruby on rails': ['Ruby Agent', 'Web BFF-Backend Agent'],
            'rspec': ['Ruby Agent', 'Test Strategy Agent'],
            'sidekiq': ['Ruby Agent', 'Message Queue Agent'],
            'swift': ['Swift Agent', 'Mobile Architecture Agent'],
            'swiftui': ['Swift Agent', 'Mobile UI Agent'],
            'uikit': ['Swift Agent', 'Mobile UI Agent'],
            'xcode': ['Swift Agent', 'Mobile CI-CD Agent'],
            'kotlin': ['Kotlin Agent', 'Mobile Architecture Agent'],
            'jetpack compose': ['Kotlin Agent', 'Mobile UI Agent'],
            'ktor': ['Kotlin Agent', 'Web BFF-Backend Agent'],
            'coroutines': ['Kotlin Agent', 'Performance & Efficiency Agent'],
            'cpp': ['C C++ Agent', 'Performance & Efficiency Agent'],
            'c++': ['C C++ Agent', 'Performance & Efficiency Agent'],
            'cmake': ['C C++ Agent', 'Platform-DevOps Agent'],
            'embedded': ['C C++ Agent', 'Rust Agent'],
            'systems programming': ['C C++ Agent', 'Rust Agent', 'Go Agent'],
            'zustand': ['State Management Agent', 'Frontend Web Agent'],
            'cliente servidor': ['Client-Server Architecture Agent', 'API Gateway Agent'],
            'client server': ['Client-Server Architecture Agent', 'API Gateway Agent'],
            'load balancer': ['Load Balancer & Scaling Agent', 'Cloud Architecture Agent'],
            'balanceo de carga': ['Load Balancer & Scaling Agent', 'Cloud Architecture Agent'],
            'api gateway': ['API Gateway Agent', 'Client-Server Architecture Agent'],
            'session': ['Session & State Management Agent', 'Cloud Security Agent'],
            'sesion': ['Session & State Management Agent', 'Cloud Security Agent'],
            'jwt': ['Session & State Management Agent', 'Cloud Security Agent'],
            'oauth': ['Session & State Management Agent', 'Cloud Security Agent'],
            'escalabilidad': ['Load Balancer & Scaling Agent', 'Cloud Architecture Agent'],
            'scaling': ['Load Balancer & Scaling Agent', 'Cloud Architecture Agent'],
            'alta disponibilidad': ['Load Balancer & Scaling Agent', 'SRE Agent', 'Chaos & Resilience Agent'],
            'high availability': ['Load Balancer & Scaling Agent', 'SRE Agent', 'Chaos & Resilience Agent'],
            'request response': ['Request-Response Pattern Agent', 'API Gateway Agent'],
            'rest api': ['Request-Response Pattern Agent', 'API Gateway Agent'],
            'distribuido': ['Client-Server Architecture Agent', 'Cloud Architecture Agent'],
            'distributed': ['Client-Server Architecture Agent', 'Cloud Architecture Agent'],
            'monetizacion': ['Monetization Strategy Agent', 'Data & Analytics Agent'],
            'monetization': ['Monetization Strategy Agent', 'Data & Analytics Agent'],
            'pricing': ['Monetization Strategy Agent'],
            'freemium': ['Monetization Strategy Agent'],
            'subscription': ['Monetization Strategy Agent'],
            'revenue': ['Monetization Strategy Agent', 'Data & Analytics Agent'],
            'ingresos': ['Monetization Strategy Agent', 'Data & Analytics Agent'],
            'paywall': ['Monetization Strategy Agent'],
            'conversion': ['Monetization Strategy Agent', 'Marketing Campaigns Agent'],
            'arpu': ['Monetization Strategy Agent'],
            'ltv': ['Monetization Strategy Agent'],
            'churn': ['Monetization Strategy Agent', 'Marketing Campaigns Agent'],
            'marketing': ['Marketing Campaigns Agent'],
            'campañas': ['Marketing Campaigns Agent'],
            'campaigns': ['Marketing Campaigns Agent'],
            'email marketing': ['Marketing Campaigns Agent'],
            'social media': ['Marketing Campaigns Agent'],
            'ads': ['Marketing Campaigns Agent'],
            'publicidad': ['Marketing Campaigns Agent'],
            'acquisition': ['Marketing Campaigns Agent', 'Monetization Strategy Agent'],
            'adquisicion': ['Marketing Campaigns Agent', 'Monetization Strategy Agent'],
            'retention': ['Marketing Campaigns Agent', 'Monetization Strategy Agent'],
            'retencion': ['Marketing Campaigns Agent', 'Monetization Strategy Agent'],
            'cac': ['Marketing Campaigns Agent', 'Monetization Strategy Agent'],
            'roas': ['Marketing Campaigns Agent'],
            'seo': ['Marketing Campaigns Agent'],
            'growth': ['Marketing Campaigns Agent', 'Monetization Strategy Agent'],
            'crecimiento': ['Marketing Campaigns Agent', 'Monetization Strategy Agent'],
            'evolucion': ['Platform Evolution Strategy Agent', 'Cloud Architecture Agent'],
            'evolution': ['Platform Evolution Strategy Agent', 'Cloud Architecture Agent'],
            'transformacion': ['Platform Evolution Strategy Agent', 'Migration Agent'],
            'transformation': ['Platform Evolution Strategy Agent', 'Migration Agent'],
            'desktop a web': ['Platform Evolution Strategy Agent', 'Web Architecture Agent'],
            'desktop a mobile': ['Platform Evolution Strategy Agent', 'Mobile Architecture Agent'],
            'desktop a android': ['Platform Evolution Strategy Agent', 'Mobile Architecture Agent'],
            'desktop a ios': ['Platform Evolution Strategy Agent', 'Mobile Architecture Agent'],
            'expansion': ['Platform Evolution Strategy Agent', 'Marketing Campaigns Agent'],
            'multi-plataforma': ['Platform Evolution Strategy Agent', 'Mobile Architecture Agent'],
            'multiplatform': ['Platform Evolution Strategy Agent', 'Mobile Architecture Agent'],
            'strangler': ['Platform Evolution Strategy Agent', 'Cloud Architecture Agent'],
            'modernizacion': ['Platform Evolution Strategy Agent', 'Cloud Architecture Agent'],
            'modernization': ['Platform Evolution Strategy Agent', 'Cloud Architecture Agent'],
            'legacy': ['Platform Evolution Strategy Agent', 'Migration Agent'],

            // Billing & Payments
            'facturacion': ['Billing & Invoicing Agent', 'Payment Gateway Agent'],
            'billing': ['Billing & Invoicing Agent', 'Payment Gateway Agent'],
            'invoicing': ['Billing & Invoicing Agent'],
            'factura': ['Billing & Invoicing Agent'],
            'invoice': ['Billing & Invoicing Agent'],
            'prorrateo': ['Billing & Invoicing Agent'],
            'proration': ['Billing & Invoicing Agent'],
            'suscripcion': ['Billing & Invoicing Agent', 'Monetization Strategy Agent'],
            'payment gateway': ['Payment Gateway Agent'],
            'pasarela de pago': ['Payment Gateway Agent'],
            'stripe': ['Payment Gateway Agent'],
            'paypal': ['Payment Gateway Agent'],
            'mercadopago': ['Payment Gateway Agent'],
            'webhook': ['Payment Gateway Agent', 'Notification Engine Agent'],
            'reconciliacion': ['Payment Gateway Agent', 'Billing & Invoicing Agent'],
            'reconciliation': ['Payment Gateway Agent', 'Billing & Invoicing Agent'],
            'reembolso': ['Payment Gateway Agent'],
            'refund': ['Payment Gateway Agent'],

            // Notifications
            'notificaciones': ['Notification Engine Agent', 'Marketing Campaigns Agent'],
            'notifications': ['Notification Engine Agent', 'Marketing Campaigns Agent'],
            'push notification': ['Notification Engine Agent', 'Mobile Data Agent'],
            'email template': ['Notification Engine Agent'],
            'sms': ['Notification Engine Agent'],
            'in-app': ['Notification Engine Agent'],

            // DDD
            'ddd': ['Domain-Driven Design Agent', 'Cloud Architecture Agent'],
            'domain driven': ['Domain-Driven Design Agent'],
            'bounded context': ['Domain-Driven Design Agent'],
            'agregado': ['Domain-Driven Design Agent'],
            'aggregate': ['Domain-Driven Design Agent'],
            'value object': ['Domain-Driven Design Agent'],
            'domain event': ['Domain-Driven Design Agent'],
            'cqrs': ['Domain-Driven Design Agent', 'Cloud Architecture Agent'],
            'event sourcing': ['Domain-Driven Design Agent', 'Cloud Architecture Agent'],
            'ubiquitous language': ['Domain-Driven Design Agent'],

            // Multi-tenant
            'multi-tenant': ['Multi-tenant SaaS Platform Agent', 'Cloud Architecture Agent'],
            'multitenant': ['Multi-tenant SaaS Platform Agent', 'Cloud Architecture Agent'],
            'tenant': ['Multi-tenant SaaS Platform Agent'],
            'saas platform': ['Multi-tenant SaaS Platform Agent', 'Cloud Architecture Agent'],
            'row level security': ['Multi-tenant SaaS Platform Agent', 'Database Architect Agent'],
            'data isolation': ['Multi-tenant SaaS Platform Agent', 'Cloud Security Agent'],

            // Migration & Legacy
            'migracion': ['COBOL Migration Agent', 'Delphi Legacy Migration Agent', 'Visual Basic 6 Migration Agent', 'FoxPro Migration Agent'],
            'migration': ['COBOL Migration Agent', 'Delphi Legacy Migration Agent', 'Visual Basic 6 Migration Agent', 'FoxPro Migration Agent'],
            'legacy': ['COBOL Migration Agent', 'Delphi Legacy Migration Agent', 'Visual Basic 6 Migration Agent', 'RPG AS400 Migration Agent'],
            'modernizacion': ['COBOL Migration Agent', 'Classic ASP Migration Agent', 'Oracle Forms Migration Agent', 'PowerBuilder Migration Agent'],
            'modernization': ['COBOL Migration Agent', 'Classic ASP Migration Agent', 'Oracle Forms Migration Agent', 'PowerBuilder Migration Agent'],
            'cobol': ['COBOL Migration Agent'],
            'mainframe': ['COBOL Migration Agent', 'RPG AS400 Migration Agent', 'PL-I Migration Agent', 'Natural ADABAS Migration Agent'],
            'as400': ['RPG AS400 Migration Agent'],
            'iseries': ['RPG AS400 Migration Agent'],
            'ibm i': ['RPG AS400 Migration Agent'],
            'rpg': ['RPG AS400 Migration Agent'],
            'vb6': ['Visual Basic 6 Migration Agent'],
            'visual basic': ['Visual Basic 6 Migration Agent'],
            'activex': ['Visual Basic 6 Migration Agent', 'Classic ASP Migration Agent'],
            'foxpro': ['FoxPro Migration Agent'],
            'vfp': ['FoxPro Migration Agent'],
            'xbase': ['FoxPro Migration Agent', 'Clipper Migration Agent'],
            'dbf': ['FoxPro Migration Agent', 'Clipper Migration Agent'],
            'clipper': ['Clipper Migration Agent'],
            'harbour': ['Clipper Migration Agent'],
            'powerbuilder': ['PowerBuilder Migration Agent'],
            'datawindow': ['PowerBuilder Migration Agent'],
            'informix': ['Informix 4GL Migration Agent'],
            '4gl': ['Informix 4GL Migration Agent', 'Progress 4GL Migration Agent', 'Natural ADABAS Migration Agent'],
            'oracle forms': ['Oracle Forms Migration Agent'],
            'apex migration': ['Oracle Forms Migration Agent'],
            'natural': ['Natural ADABAS Migration Agent'],
            'adabas': ['Natural ADABAS Migration Agent'],
            'software ag': ['Natural ADABAS Migration Agent'],
            'progress': ['Progress 4GL Migration Agent'],
            'openedge': ['Progress 4GL Migration Agent'],
            'lotus notes': ['Lotus Notes Migration Agent'],
            'domino': ['Lotus Notes Migration Agent'],
            'nsf': ['Lotus Notes Migration Agent'],
            'asp clasico': ['Classic ASP Migration Agent'],
            'classic asp': ['Classic ASP Migration Agent'],
            'vbscript': ['Classic ASP Migration Agent', 'Visual Basic 6 Migration Agent'],
            'mumps': ['MUMPS Migration Agent'],
            'intersystems': ['MUMPS Migration Agent'],
            'cache': ['MUMPS Migration Agent'],
            'iris': ['MUMPS Migration Agent'],
            'healthcare legacy': ['MUMPS Migration Agent'],
            'pli': ['PL-I Migration Agent'],
            'pl/i': ['PL-I Migration Agent'],
            'fortran': ['Fortran Migration Agent'],
            'f77': ['Fortran Migration Agent'],
            'scientific computing': ['Fortran Migration Agent'],
            'hpc legacy': ['Fortran Migration Agent'],
            'bde': ['Delphi Legacy Migration Agent'],
            'borland': ['Delphi Legacy Migration Agent', 'Clipper Migration Agent'],
            'paradox': ['Delphi Legacy Migration Agent', 'FoxPro Migration Agent'],

            // Legacy Maintenance
            'mantenimiento': ['COBOL Maintenance Agent', 'Delphi 4-7 Maintenance Agent', 'Visual Basic 6 Maintenance Agent', 'FoxPro Maintenance Agent'],
            'maintenance': ['COBOL Maintenance Agent', 'Delphi 4-7 Maintenance Agent', 'Visual Basic 6 Maintenance Agent', 'FoxPro Maintenance Agent'],
            'mantener': ['COBOL Maintenance Agent', 'RPG AS400 Maintenance Agent', 'Oracle Forms Maintenance Agent'],
            'debuggear': ['COBOL Maintenance Agent', 'Delphi 4-7 Maintenance Agent', 'Visual Basic 6 Maintenance Agent'],
            'debug legacy': ['COBOL Maintenance Agent', 'RPG AS400 Maintenance Agent', 'MUMPS M Maintenance Agent'],
            'cobol maintenance': ['COBOL Maintenance Agent'],
            'delphi legacy': ['Delphi 4-7 Maintenance Agent', 'Delphi Legacy Migration Agent'],
            'delphi 4': ['Delphi 4-7 Maintenance Agent'],
            'delphi 5': ['Delphi 4-7 Maintenance Agent'],
            'delphi 6': ['Delphi 4-7 Maintenance Agent'],
            'delphi 7': ['Delphi 4-7 Maintenance Agent'],
            'vb6 maintenance': ['Visual Basic 6 Maintenance Agent'],
            'foxpro maintenance': ['FoxPro Maintenance Agent'],
            'clipper maintenance': ['Clipper Harbour Maintenance Agent'],
            'harbour maintenance': ['Clipper Harbour Maintenance Agent'],
            'powerbuilder maintenance': ['PowerBuilder Maintenance Agent'],
            'informix maintenance': ['Informix 4GL Maintenance Agent'],
            'oracle forms maintenance': ['Oracle Forms Maintenance Agent'],
            'rpg maintenance': ['RPG AS400 Maintenance Agent'],
            'as400 maintenance': ['RPG AS400 Maintenance Agent'],
            'natural maintenance': ['Natural ADABAS Maintenance Agent'],
            'adabas maintenance': ['Natural ADABAS Maintenance Agent'],
            'progress maintenance': ['Progress 4GL Maintenance Agent'],
            'asp maintenance': ['Classic ASP Maintenance Agent'],
            'mumps maintenance': ['MUMPS M Maintenance Agent'],
            'pli maintenance': ['PL-I Maintenance Agent'],
            'fortran maintenance': ['Fortran Maintenance Agent'],
            'legacy code': ['COBOL Maintenance Agent', 'Visual Basic 6 Maintenance Agent', 'FoxPro Maintenance Agent', 'Clipper Harbour Maintenance Agent'],
            'codigo legacy': ['COBOL Maintenance Agent', 'Visual Basic 6 Maintenance Agent', 'FoxPro Maintenance Agent', 'RPG AS400 Maintenance Agent'],
            'retro': ['COBOL Maintenance Agent', 'Delphi 4-7 Maintenance Agent', 'Visual Basic 6 Maintenance Agent', 'Clipper Harbour Maintenance Agent'],
            'vintage code': ['COBOL Maintenance Agent', 'Fortran Maintenance Agent', 'PL-I Maintenance Agent'],

            // ========== ROLES & LEADERSHIP AGENTS ==========
            // Liderazgo y Gestión
            'cto': ['CTO Agent', 'VP Engineering Agent', 'Principal Engineer Agent'],
            'chief technology officer': ['CTO Agent'],
            'director tecnologia': ['CTO Agent', 'VP Engineering Agent'],
            'vision tecnologica': ['CTO Agent', 'Principal Engineer Agent'],
            'roadmap tecnologico': ['CTO Agent', 'Product Manager Agent'],
            'vp': ['VP Engineering Agent', 'CTO Agent'],
            'vp engineering': ['VP Engineering Agent'],
            'vicepresidente': ['VP Engineering Agent', 'CTO Agent'],
            'vicepresidente ingenieria': ['VP Engineering Agent'],
            'hiring': ['VP Engineering Agent', 'Engineering Manager Agent'],
            'contratacion': ['VP Engineering Agent', 'Engineering Manager Agent'],
            'cultura': ['VP Engineering Agent', 'Agile Coach Agent'],
            'em': ['Engineering Manager Agent', 'Tech Lead Agent'],
            'engineering manager': ['Engineering Manager Agent'],
            'gerente ingenieria': ['Engineering Manager Agent'],
            'gerente de ingenieria': ['Engineering Manager Agent'],
            'one on one': ['Engineering Manager Agent', 'Tech Lead Agent'],
            '1:1': ['Engineering Manager Agent', 'Tech Lead Agent'],
            'desarrollo de carrera': ['Engineering Manager Agent', 'VP Engineering Agent'],
            'career development': ['Engineering Manager Agent', 'VP Engineering Agent'],
            'pm': ['Project Manager Agent', 'Product Manager Agent'],
            'project manager': ['Project Manager Agent'],
            'jefe de proyectos': ['Project Manager Agent'],
            'jefe proyectos': ['Project Manager Agent'],
            'gestor proyectos': ['Project Manager Agent'],
            'planificacion': ['Project Manager Agent', 'Scrum Master Agent', 'Delivery Manager Agent'],
            'stakeholders': ['Project Manager Agent', 'Product Manager Agent'],
            'riesgos': ['Project Manager Agent', 'Solutions Architect Agent'],
            'product manager': ['Product Manager Agent'],
            'roadmap producto': ['Product Manager Agent', 'Product Owner Agent'],
            'priorizacion': ['Product Manager Agent', 'Product Owner Agent', 'Scrum Master Agent'],
            'metricas producto': ['Product Manager Agent', 'Data Lead Agent'],
            'discovery producto': ['Product Manager Agent', 'UX Lead Agent'],
            'po': ['Product Owner Agent', 'Product Manager Agent'],
            'product owner': ['Product Owner Agent'],
            'backlog': ['Product Owner Agent', 'Scrum Master Agent'],
            'historias de usuario': ['Product Owner Agent', 'Product Manager Agent'],
            'user stories': ['Product Owner Agent', 'Product Manager Agent'],
            'criterios de aceptacion': ['Product Owner Agent', 'QA Lead Agent'],
            'acceptance criteria': ['Product Owner Agent', 'QA Lead Agent'],
            'refinamiento': ['Product Owner Agent', 'Scrum Master Agent'],
            'grooming': ['Product Owner Agent', 'Scrum Master Agent'],

            // Liderazgo Técnico
            'tl': ['Tech Lead Agent', 'Staff Engineer Agent'],
            'tech lead': ['Tech Lead Agent'],
            'lider tecnico': ['Tech Lead Agent', 'Staff Engineer Agent'],
            'technical lead': ['Tech Lead Agent'],
            'code review lead': ['Tech Lead Agent', 'Staff Engineer Agent'],
            'mentoring': ['Tech Lead Agent', 'Engineering Manager Agent', 'Staff Engineer Agent'],
            'staff': ['Staff Engineer Agent', 'Principal Engineer Agent'],
            'staff engineer': ['Staff Engineer Agent'],
            'ingeniero staff': ['Staff Engineer Agent'],
            'cross-team': ['Staff Engineer Agent', 'Principal Engineer Agent'],
            'cross team': ['Staff Engineer Agent', 'Principal Engineer Agent'],
            'estandares tecnicos': ['Staff Engineer Agent', 'Enterprise Architect Agent'],
            'principal': ['Principal Engineer Agent', 'Staff Engineer Agent'],
            'principal engineer': ['Principal Engineer Agent'],
            'ingeniero principal': ['Principal Engineer Agent'],
            'tech strategy': ['Principal Engineer Agent', 'CTO Agent'],
            'estrategia tecnica': ['Principal Engineer Agent', 'CTO Agent'],
            'org-wide': ['Principal Engineer Agent', 'Enterprise Architect Agent'],
            'solutions architect': ['Solutions Architect Agent', 'Enterprise Architect Agent'],
            'arquitecto de soluciones': ['Solutions Architect Agent'],
            'arquitecto soluciones': ['Solutions Architect Agent'],
            'integraciones': ['Solutions Architect Agent', 'API Gateway Agent'],
            'vendors': ['Solutions Architect Agent', 'FinOps & Cost Agent'],
            'enterprise architect': ['Enterprise Architect Agent'],
            'arquitecto empresarial': ['Enterprise Architect Agent'],
            'arquitectura corporativa': ['Enterprise Architect Agent', 'Solutions Architect Agent'],
            'governance': ['Enterprise Architect Agent', 'Compliance Agent'],
            'gobernanza': ['Enterprise Architect Agent', 'Compliance Agent'],

            // Agilidad y Procesos
            'sm': ['Scrum Master Agent', 'Agile Coach Agent'],
            'scrum master': ['Scrum Master Agent'],
            'facilitacion': ['Scrum Master Agent', 'Agile Coach Agent'],
            'facilitator': ['Scrum Master Agent', 'Agile Coach Agent'],
            'impedimentos': ['Scrum Master Agent', 'Delivery Manager Agent'],
            'blockers': ['Scrum Master Agent', 'Delivery Manager Agent'],
            'mejora continua': ['Scrum Master Agent', 'Agile Coach Agent'],
            'retrospectiva': ['Scrum Master Agent', 'Agile Coach Agent'],
            'daily': ['Scrum Master Agent'],
            'sprint': ['Scrum Master Agent', 'Product Owner Agent', 'Delivery Manager Agent'],
            'agile coach': ['Agile Coach Agent', 'Scrum Master Agent'],
            'coach agil': ['Agile Coach Agent'],
            'transformacion agil': ['Agile Coach Agent', 'Delivery Manager Agent'],
            'agile transformation': ['Agile Coach Agent'],
            'multiple equipos': ['Agile Coach Agent', 'VP Engineering Agent'],
            'cultura agil': ['Agile Coach Agent', 'Scrum Master Agent'],
            'rte': ['Release Train Engineer Agent', 'Agile Coach Agent'],
            'release train engineer': ['Release Train Engineer Agent'],
            'pi planning': ['Release Train Engineer Agent', 'Agile Coach Agent'],
            'safe': ['Release Train Engineer Agent', 'Agile Coach Agent'],
            'scaled agile': ['Release Train Engineer Agent', 'Agile Coach Agent'],
            'art': ['Release Train Engineer Agent'],
            'agile release train': ['Release Train Engineer Agent'],
            'delivery manager': ['Delivery Manager Agent', 'Project Manager Agent'],
            'gerente de entrega': ['Delivery Manager Agent'],
            'flujo': ['Delivery Manager Agent', 'Scrum Master Agent'],
            'flow': ['Delivery Manager Agent'],
            'predictibilidad': ['Delivery Manager Agent', 'Project Manager Agent'],
            'lead time': ['Delivery Manager Agent', 'Scrum Master Agent'],
            'cycle time': ['Delivery Manager Agent'],
            'throughput': ['Delivery Manager Agent', 'Performance & Efficiency Agent'],

            // Especialistas de Equipo
            'qa lead': ['QA Lead Agent', 'Test Strategy Agent'],
            'lider qa': ['QA Lead Agent'],
            'jefe de qa': ['QA Lead Agent'],
            'estrategia de testing': ['QA Lead Agent', 'Test Strategy Agent'],
            'test strategy': ['QA Lead Agent', 'Test Strategy Agent'],
            'equipo qa': ['QA Lead Agent'],
            'calidad software': ['QA Lead Agent', 'Quality Gatekeeper Agent'],
            'devops lead': ['DevOps Lead Agent', 'Platform-DevOps Agent'],
            'lider devops': ['DevOps Lead Agent'],
            'jefe devops': ['DevOps Lead Agent'],
            'infraestructura equipo': ['DevOps Lead Agent', 'Platform-DevOps Agent'],
            'plataforma interna': ['DevOps Lead Agent', 'Platform Engineer Agent'],
            'ux lead': ['UX Lead Agent', 'Design System Steward Agent'],
            'lider ux': ['UX Lead Agent'],
            'jefe de ux': ['UX Lead Agent'],
            'user research': ['UX Lead Agent', 'Product Manager Agent'],
            'investigacion usuarios': ['UX Lead Agent', 'Product Manager Agent'],
            'design system lead': ['UX Lead Agent', 'Design System Steward Agent'],
            'experiencia usuario': ['UX Lead Agent', 'Web Accessibility Agent'],
            'data lead': ['Data Lead Agent', 'Data & Analytics Agent'],
            'lider de datos': ['Data Lead Agent'],
            'jefe de datos': ['Data Lead Agent'],
            'estrategia de datos': ['Data Lead Agent', 'Data & Analytics Agent'],
            'data strategy': ['Data Lead Agent'],
            'data governance': ['Data Lead Agent', 'Compliance Agent'],
            'gobernanza de datos': ['Data Lead Agent', 'Compliance Agent'],
            'security lead': ['Security Lead Agent', 'Cloud Security Agent'],
            'lider de seguridad': ['Security Lead Agent'],
            'jefe de seguridad': ['Security Lead Agent'],
            'sdlc seguro': ['Security Lead Agent', 'Security Testing Integrator Agent'],
            'secure sdlc': ['Security Lead Agent', 'Security Testing Integrator Agent'],
            'compliance lead': ['Security Lead Agent', 'Compliance Agent'],

            // Roles Emergentes
            'ai lead': ['AI ML Lead Agent', 'ML Ops Agent'],
            'ml lead': ['AI ML Lead Agent', 'ML Ops Agent'],
            'lider ia': ['AI ML Lead Agent'],
            'lider ml': ['AI ML Lead Agent'],
            'jefe de ia': ['AI ML Lead Agent'],
            'estrategia ia': ['AI ML Lead Agent', 'CTO Agent'],
            'ai strategy': ['AI ML Lead Agent', 'CTO Agent'],
            'modelos produccion': ['AI ML Lead Agent', 'ML Ops Agent'],
            'models in production': ['AI ML Lead Agent', 'ML Ops Agent'],
            'platform engineer': ['Platform Engineer Agent', 'Platform-DevOps Agent'],
            'ingeniero de plataforma': ['Platform Engineer Agent'],
            'internal developer platform': ['Platform Engineer Agent', 'DevOps Lead Agent'],
            'idp': ['Platform Engineer Agent', 'DevOps Lead Agent'],
            'developer experience': ['Platform Engineer Agent', 'Developer Advocate Agent'],
            'dx': ['Platform Engineer Agent', 'Developer Advocate Agent'],
            'sre lead': ['Site Reliability Lead Agent', 'SRE Agent'],
            'lider sre': ['Site Reliability Lead Agent'],
            'jefe sre': ['Site Reliability Lead Agent'],
            'reliability lead': ['Site Reliability Lead Agent', 'SRE Agent'],
            'slos': ['Site Reliability Lead Agent', 'SRE Agent'],
            'slis': ['Site Reliability Lead Agent', 'SRE Agent'],
            'error budget': ['Site Reliability Lead Agent', 'SRE Agent'],
            'incident management': ['Site Reliability Lead Agent', 'Incident Commander Agent'],
            'gestion de incidentes': ['Site Reliability Lead Agent', 'Incident Commander Agent'],
            'devrel': ['Developer Advocate Agent', 'Documentador Agent'],
            'developer advocate': ['Developer Advocate Agent'],
            'developer relations': ['Developer Advocate Agent'],
            'evangelista': ['Developer Advocate Agent'],
            'onboarding developers': ['Developer Advocate Agent', 'Docs & Knowledge Agent'],
            'comunidad desarrolladores': ['Developer Advocate Agent'],
            'developer community': ['Developer Advocate Agent'],
            'technical writing': ['Developer Advocate Agent', 'Documentador Agent'],

            // General Role Keywords
            'liderazgo': ['CTO Agent', 'VP Engineering Agent', 'Engineering Manager Agent', 'Tech Lead Agent'],
            'leadership': ['CTO Agent', 'VP Engineering Agent', 'Engineering Manager Agent', 'Tech Lead Agent'],
            'gestion': ['Engineering Manager Agent', 'Project Manager Agent', 'Delivery Manager Agent'],
            'management': ['Engineering Manager Agent', 'Project Manager Agent', 'Delivery Manager Agent'],
            'equipo': ['Engineering Manager Agent', 'Tech Lead Agent', 'Scrum Master Agent'],
            'team': ['Engineering Manager Agent', 'Tech Lead Agent', 'Scrum Master Agent'],
            'jefe': ['Project Manager Agent', 'Engineering Manager Agent', 'QA Lead Agent', 'DevOps Lead Agent'],
            'lider': ['Tech Lead Agent', 'QA Lead Agent', 'DevOps Lead Agent', 'UX Lead Agent', 'Data Lead Agent', 'Security Lead Agent'],
            'lead': ['Tech Lead Agent', 'QA Lead Agent', 'DevOps Lead Agent', 'UX Lead Agent', 'Data Lead Agent', 'Security Lead Agent'],
            'cargo': ['CTO Agent', 'VP Engineering Agent', 'Engineering Manager Agent', 'Project Manager Agent', 'Product Manager Agent'],
            'rol': ['CTO Agent', 'VP Engineering Agent', 'Engineering Manager Agent', 'Tech Lead Agent', 'Scrum Master Agent'],
            'role': ['CTO Agent', 'VP Engineering Agent', 'Engineering Manager Agent', 'Tech Lead Agent', 'Scrum Master Agent'],
            'director': ['CTO Agent', 'VP Engineering Agent'],
            'gerente': ['Engineering Manager Agent', 'Project Manager Agent', 'Delivery Manager Agent'],
            'manager': ['Engineering Manager Agent', 'Project Manager Agent', 'Product Manager Agent', 'Delivery Manager Agent'],
            'arquitecto': ['Solutions Architect Agent', 'Enterprise Architect Agent', 'Principal Engineer Agent'],
            'architect': ['Solutions Architect Agent', 'Enterprise Architect Agent', 'Principal Engineer Agent'],
            'coach': ['Agile Coach Agent', 'Scrum Master Agent'],
            'especialista': ['Staff Engineer Agent', 'Principal Engineer Agent', 'QA Lead Agent', 'DevOps Lead Agent'],
            'specialist': ['Staff Engineer Agent', 'Principal Engineer Agent', 'QA Lead Agent', 'DevOps Lead Agent'],

            // Prompt Engineering e IA
            'prompt': ['Prompt Generator Agent', 'Docs & Knowledge Agent'],
            'prompts': ['Prompt Generator Agent', 'Docs & Knowledge Agent'],
            'generador': ['Prompt Generator Agent'],
            'generator': ['Prompt Generator Agent'],
            'llm': ['Prompt Generator Agent', 'ML Eng & Training Agent'],
            'gpt': ['Prompt Generator Agent', 'ML Eng & Training Agent'],
            'claude': ['Prompt Generator Agent'],
            'copilot': ['Prompt Generator Agent'],
            'ia': ['Prompt Generator Agent', 'ML Eng & Training Agent', 'AI Ethics & Governance Agent'],
            'ai': ['Prompt Generator Agent', 'ML Eng & Training Agent', 'AI Ethics & Governance Agent'],
            'instrucciones': ['Prompt Generator Agent', 'Docs & Knowledge Agent'],
            'contexto': ['Prompt Generator Agent', 'Docs & Knowledge Agent'],
            'template': ['Prompt Generator Agent', 'Documentador Agent'],
            'plantilla': ['Prompt Generator Agent', 'Documentador Agent'],
        };

        const kits = {
            startup: {
                title: 'Startup (1-5 ingenieros)',
                description: 'Objetivo: rapidez con higiene minima. Max 6 agentes.',
                sections: [
                    {
                        title: 'Web-first',
                        badge: 'required',
                        agents: ['Web Architecture Agent', 'Frontend Web Agent', 'Web BFF-Backend Agent', 'Web CI-CD Agent', 'Bug Hunter Agent', 'Test Strategy Agent']
                    },
                    {
                        title: 'Mobile-first',
                        badge: 'required',
                        agents: ['Mobile Architecture Agent', 'Mobile UI Agent', 'Mobile Data Agent', 'Mobile CI-CD Agent', 'Bug Hunter Agent']
                    },
                    {
                        title: 'Cloud minimo',
                        badge: 'recommended',
                        agents: ['Platform-DevOps Agent', 'Cloud Security Agent']
                    }
                ]
            },
            scaleup: {
                title: 'Scale-up (6-20 ingenieros)',
                description: 'Objetivo: velocidad + consistencia. Agrega transversales obligatorios.',
                sections: [
                    {
                        title: 'Transversales obligatorios',
                        badge: 'required',
                        agents: ['Bug Hunter Agent', 'Refactor & Code Quality Agent', 'Test Strategy Agent', 'Performance & Efficiency Agent', 'Technology Critic & Improvement Agent', 'Docs & Knowledge Agent']
                    },
                    {
                        title: 'Web core',
                        badge: 'required',
                        agents: ['Web Architecture Agent', 'Frontend Web Agent', 'Web BFF-Backend Agent', 'Web QA Agent', 'Web CI-CD Agent', 'Web DX Agent']
                    },
                    {
                        title: 'Cloud recomendado',
                        badge: 'recommended',
                        agents: ['Cloud Architecture Agent', 'Platform-DevOps Agent', 'GitOps CI-CD Cloud Agent', 'Observability Agent', 'Cloud Security Agent']
                    },
                    {
                        title: 'Security',
                        badge: 'recommended',
                        agents: ['Threat Modeling Agent', 'Security Testing Integrator Agent', 'License Reviewer & OSS Alternatives Agent']
                    }
                ]
            },
            multisquad: {
                title: 'Multi-squad (21-80 ingenieros)',
                description: 'Objetivo: estandarizacion y escalabilidad organizacional.',
                sections: [
                    {
                        title: 'Arquitectura por plataforma',
                        badge: 'required',
                        agents: ['Web Architecture Agent', 'Mobile Architecture Agent', 'Desktop Architecture Agent', 'Cloud Architecture Agent']
                    },
                    {
                        title: 'DX y templates',
                        badge: 'required',
                        agents: ['Web DX Agent', 'Platform-DevOps Agent', 'Web CI-CD Agent', 'GitOps CI-CD Cloud Agent']
                    },
                    {
                        title: 'Confiabilidad y seguridad',
                        badge: 'required',
                        agents: ['Observability Agent', 'Cloud Security Agent', 'Threat Modeling Agent', 'Security Testing Integrator Agent', 'Quality Gatekeeper Agent']
                    },
                    {
                        title: 'Transversales',
                        badge: 'required',
                        agents: ['Bug Hunter Agent', 'Refactor & Code Quality Agent', 'Performance & Efficiency Agent', 'Test Strategy Agent', 'Technology Critic & Improvement Agent', 'License Reviewer & OSS Alternatives Agent']
                    }
                ]
            },
            enterprise: {
                title: 'Enterprise (80+ ingenieros)',
                description: 'Objetivo: gobernanza fuerte y confiabilidad. Global Policy obligatorio.',
                sections: [
                    {
                        title: 'Cloud obligatorio',
                        badge: 'required',
                        agents: ['Cloud Architecture Agent', 'Platform-DevOps Agent', 'GitOps CI-CD Cloud Agent', 'Cloud Security Agent', 'Observability Agent', 'SRE Agent', 'Security Testing Integrator Agent', 'Quality Gatekeeper Agent']
                    },
                    {
                        title: 'Security obligatorio',
                        badge: 'required',
                        agents: ['Threat Modeling Agent', 'Ethical Hacker & PenTest Advisor Agent', 'License Reviewer & OSS Alternatives Agent']
                    },
                    {
                        title: 'Transversal obligatorio',
                        badge: 'required',
                        agents: ['Bug Hunter Agent', 'Refactor & Code Quality Agent', 'Performance & Efficiency Agent', 'Test Strategy Agent', 'Technology Critic & Improvement Agent', 'Release Manager Agent', 'Docs & Knowledge Agent', 'Data & Analytics Agent', 'Design System Steward Agent', 'Quality Gatekeeper Agent']
                    },
                    {
                        title: 'Squad Operativo',
                        badge: 'recommended',
                        agents: ['Incident Commander Agent', 'Runbook & Operations Agent', 'Postmortem & Learning Agent', 'Chaos & Resilience Agent', 'Capacity & Cost Governance Agent']
                    }
                ]
            }
        };

        const categoryIcons = {
            '_global': '🌐',
            'architecture': '🏗️',
            'backend': '⚙️',
            'business': '💼',
            'data': '📈',
            'design': '🎨',
            'devops': '🔄',
            'discovery': '🔍',
            'docs': '📚',
            'growth': '📊',
            'integrations': '🔗',
            'languages': '🖥️',
            'legacy-maintenance': '🔧',
            'migrations': '🚚',
            'operations': '⚡',
            'planning': '📋',
            'platform-cloud': '☁️',
            'platform-desktop': '🖥️',
            'platform-mobile': '📱',
            'platform-web': '🌐',
            'process': '🔄',
            'product': '📦',
            'quality': '✅',
            'security': '🔒',
            'testing': '🧪'
        };

        const packNames = {
            'v3.0': 'Claude Code v3.0',
            'v2.5': 'Claude Code v2.5',
            'condo': 'Condo Admin 1.0',
            'squad': 'Squad Operativo'
        };

        // Mapping from workflow agent names to catalog agent names
        const agentNameMapping = {
            'Bug Hunter': 'Bug Hunter Agent',
            'Test Strategy': 'Test Strategy Agent',
            'Refactor & Code Quality': 'Refactor & Code Quality Agent',
            'CI/CD': 'GitOps CI-CD Cloud Agent',
            'CI/CD Agent': 'GitOps CI-CD Cloud Agent',
            'Observability': 'Observability Agent',
            'Product-Discovery': 'Web Product-Discovery Agent',
            'Architecture': 'Cloud Architecture Agent',
            'Dev (Frontend/Backend)': 'Frontend Web Agent',
            'Dev': 'Frontend Web Agent',
            'QA': 'Web QA Agent',
            'DX Agent': 'Web DX Agent',
            'Performance & Efficiency': 'Performance & Efficiency Agent',
            'Cloud Architecture': 'Cloud Architecture Agent',
            'Platform/DevOps': 'Platform-DevOps Agent',
            'Technology Critic': 'Technology Critic & Improvement Agent',
            'Security': 'Cloud Security Agent',
            'CI/CD templates': 'GitOps CI-CD Cloud Agent',
            'Product/UX': 'Web Product-Discovery Agent',
            'API Contracts': 'Condo Interface & API Contracts Agent',
            'SRE': 'SRE Agent',
            'Incident Commander': 'Incident Commander Agent',
            'Runbook & Operations': 'SRE Agent',
            'Postmortem': 'Incident Commander Agent',
            'Chaos & Resilience': 'Chaos & Resilience Agent',
            'Capacity': 'FinOps & Cost Agent',
            'License Reviewer': 'License Reviewer & OSS Alternatives Agent',
            'Docs & Knowledge': 'Docs & Knowledge Agent',
            'Quality Gatekeeper': 'Quality Gatekeeper Agent',
            'API Design': 'Condo Interface & API Contracts Agent',
            'GraphQL': 'Condo Interface & API Contracts Agent',
            'Contract Testing': 'Test Strategy Agent',
            'Documentador': 'Docs & Knowledge Agent',
            'Ethical Hacker': 'Ethical Hacker & PenTest Advisor Agent',
            'Threat Modeling': 'Threat Modeling Agent',
            'Vulnerability Management': 'Security Testing Integrator Agent',
            'Authentication': 'Cloud Security Agent',
            'Secret Management': 'Cloud Security Agent',
            'Mobile Architecture': 'Mobile Architecture Agent',
            'App Store Optimization': 'Mobile CI-CD Agent',
            'Push Notification': 'Mobile Data Agent',
            'Mobile CI-CD': 'Mobile CI-CD Agent',
            'Mobile QA': 'Mobile QA Agent',
            'Data Pipeline': 'Data & Analytics Agent',
            'Data Quality': 'Data & Analytics Agent',
            'ML Ops': 'Data & Analytics Agent',
            'Database Architect': 'Database Architect Agent',
            'i18n Agent': 'Frontend Web Agent',
            'Frontend': 'Frontend Web Agent',
            'Mobile UI': 'Mobile UI Agent',
            'ADR Agent': 'Docs & Knowledge Agent',
            'Onboarding': 'Docs & Knowledge Agent',
            'Code Review': 'Refactor & Code Quality Agent',
            'Configuration Management': 'Platform-DevOps Agent',
            'Migration': 'Database Architect Agent',
            'Monolith to Microservices': 'Cloud Architecture Agent',
            'Feature Flag': 'Release Manager Agent',
            'E2E Testing': 'Web QA Agent',
            'Load Testing': 'Performance & Efficiency Agent',
            'Visual Regression': 'Web QA Agent',
            'WebSocket & Real-time': 'Web BFF-Backend Agent',
            'Message Queue': 'Cloud Architecture Agent',
            'Event-Driven Architecture': 'Cloud Architecture Agent',
            'Caching Strategy': 'Performance & Efficiency Agent',
            'Cloud Security': 'Cloud Security Agent',
            'Client-Server Architecture': 'Client-Server Architecture Agent',
            'API Gateway': 'API Gateway Agent',
            'Load Balancer & Scaling': 'Load Balancer & Scaling Agent',
            'Session & State Management': 'Session & State Management Agent',
            'Request-Response Pattern': 'Request-Response Pattern Agent',
            'Monetization Strategy': 'Monetization Strategy Agent',
            'Marketing Campaigns': 'Marketing Campaigns Agent',
            'Data & Analytics': 'Data & Analytics Agent',
            'Platform Evolution Strategy': 'Platform Evolution Strategy Agent',
            'Mobile UI': 'Mobile UI Agent',
            'Mobile QA': 'Mobile QA Agent',
            // Billing & Payments
            'Billing': 'Billing & Invoicing Agent',
            'Billing & Invoicing': 'Billing & Invoicing Agent',
            'Invoicing': 'Billing & Invoicing Agent',
            'Payment Gateway': 'Payment Gateway Agent',
            'Payments': 'Payment Gateway Agent',
            // Notifications
            'Notification Engine': 'Notification Engine Agent',
            'Notifications': 'Notification Engine Agent',
            // Domain-Driven Design
            'DDD': 'Domain-Driven Design Agent',
            'Domain-Driven Design': 'Domain-Driven Design Agent',
            'Domain Modeling': 'Domain-Driven Design Agent',
            // Multi-tenant SaaS
            'Multi-tenant': 'Multi-tenant SaaS Platform Agent',
            'Multi-tenant SaaS': 'Multi-tenant SaaS Platform Agent',
            'SaaS Platform': 'Multi-tenant SaaS Platform Agent',
            'Tenant Isolation': 'Multi-tenant SaaS Platform Agent',
            // Workflow abbreviations
            'Billing & Invoicing': 'Billing & Invoicing Agent',
            'Multi-tenant SaaS': 'Multi-tenant SaaS Platform Agent'
        };

        // ==================== WIZARD STATE ====================
        let wizardState = {
            step: 1,
            problem: null,
            platform: null,
            team: null
        };

        // ==================== FUNCTIONS ====================

        // Theme Toggle
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        // Initialize theme
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
        }

        // Wizard Navigation
        function updateWizardUI() {
            // Update steps
            document.querySelectorAll('.wizard-step').forEach((step, i) => {
                step.classList.remove('active', 'completed');
                if (i + 1 < wizardState.step) step.classList.add('completed');
                if (i + 1 === wizardState.step) step.classList.add('active');
            });

            // Update pages
            document.querySelectorAll('.wizard-page').forEach(page => {
                page.classList.remove('active');
                if (parseInt(page.dataset.page) === wizardState.step) {
                    page.classList.add('active');
                }
            });

            // Restore visual selections
            const selections = {
                'problem-options': wizardState.problem,
                'platform-options': wizardState.platform,
                'team-options': wizardState.team
            };

            Object.entries(selections).forEach(([containerId, value]) => {
                const container = document.getElementById(containerId);
                if (container) {
                    container.querySelectorAll('.wizard-option').forEach(opt => {
                        opt.classList.toggle('selected', opt.dataset.value === value);
                    });
                }
            });

            // Update buttons
            document.getElementById('prev-btn').disabled = wizardState.step === 1;

            const nextBtn = document.getElementById('next-btn');
            const currentSelection = getCurrentSelection();
            nextBtn.disabled = !currentSelection;

            if (wizardState.step === 3 && currentSelection) {
                nextBtn.textContent = 'Ver Resultado →';
            } else {
                nextBtn.textContent = 'Siguiente →';
            }

            // Show/hide result
            const result = document.getElementById('wizard-result');
            const pages = document.querySelectorAll('.wizard-page');

            if (wizardState.step === 4) {
                pages.forEach(p => p.classList.remove('active'));
                result.classList.add('show');
                document.querySelector('.wizard-nav').classList.add('hidden');
                showResult();
            } else {
                result.classList.remove('show');
                document.querySelector('.wizard-nav').classList.remove('hidden');
            }
        }

        function getCurrentSelection() {
            if (wizardState.step === 1) return wizardState.problem;
            if (wizardState.step === 2) return wizardState.platform;
            if (wizardState.step === 3) return wizardState.team;
            return null;
        }

        function nextStep() {
            if (wizardState.step < 4) {
                wizardState.step++;
                updateWizardUI();
            }
        }

        function prevStep() {
            if (wizardState.step > 1) {
                wizardState.step--;
                updateWizardUI();
            }
        }

        function selectOption(container, value, stateKey) {
            wizardState[stateKey] = value;

            container.querySelectorAll('.wizard-option').forEach(opt => {
                opt.classList.remove('selected');
                if (opt.dataset.value === value) {
                    opt.classList.add('selected');
                }
            });

            updateWizardUI();
        }

        let journeySelectedAgents = [];

        function showResult() {
            const workflow = workflows.find(w => w.id === wizardState.problem);
            if (!workflow) return;

            document.getElementById('result-title').textContent = workflow.title;

            const flowContainer = document.getElementById('result-flow');
            flowContainer.innerHTML = workflow.agents.map((agent, i) => {
                const arrow = i < workflow.agents.length - 1 ? '<span class="workflow-arrow">→</span>' : '';
                return `<span class="workflow-node">${agent}</span>${arrow}`;
            }).join('');

            // Render journey agents as selectable cards
            journeySelectedAgents = [...workflow.agents];
            renderJourneyAgents(workflow.agents);

            const signalsContainer = document.getElementById('result-signals');
            signalsContainer.innerHTML = workflow.signals.map(s =>
                `<span class="signal-tag">${s}</span>`
            ).join('');
        }

        function renderJourneyAgents(agentNames) {
            const container = document.getElementById('journey-agents');
            container.innerHTML = agentNames.map(agentName => {
                const agent = agents.find(a => a.name === agentName);
                const isSelected = journeySelectedAgents.includes(agentName);
                const icon = agent ? (categoryIcons[agent.category] || '📦') : '📦';
                return `
                    <div class="journey-agent-card ${isSelected ? 'selected' : ''}" data-agent="${agentName}" onclick="toggleJourneyAgent('${agentName}')">
                        <span class="journey-agent-icon">${icon}</span>
                        <div class="journey-agent-info">
                            <div class="journey-agent-name">${agentName}</div>
                        </div>
                        <span class="journey-agent-check">${isSelected ? '✓' : ''}</span>
                    </div>
                `;
            }).join('');
        }

        function toggleJourneyAgent(agentName) {
            const index = journeySelectedAgents.indexOf(agentName);
            if (index > -1) {
                journeySelectedAgents.splice(index, 1);
            } else {
                journeySelectedAgents.push(agentName);
            }
            // Update UI
            const card = document.querySelector(`.journey-agent-card[data-agent="${agentName}"]`);
            if (card) {
                card.classList.toggle('selected');
                const check = card.querySelector('.journey-agent-check');
                check.textContent = journeySelectedAgents.includes(agentName) ? '✓' : '';
            }
        }

        function addSelectedToStack() {
            journeySelectedAgents.forEach(agentName => {
                if (!agentStack.includes(agentName)) {
                    agentStack.push(agentName);
                }
            });
            saveStack();
            updateStackUI();
            renderAgents(getCurrentFilteredAgents());

            // Show feedback
            const btn = document.getElementById('journey-add-selected');
            const originalText = btn.innerHTML;
            btn.innerHTML = '✅ Agregados al Stack!';
            setTimeout(() => {
                btn.innerHTML = originalText;
            }, 2000);
        }

        function loadTemplate(templateId) {
            const templates = {
                'startup-web': [
                    'Web Architecture Agent', 'Frontend Web Agent', 'Web BFF-Backend Agent',
                    'Web CI-CD Agent', 'Bug Hunter Agent', 'Test Strategy Agent'
                ],
                'mobile-mvp': [
                    'Mobile Architecture Agent', 'Mobile UI Agent', 'Mobile Data Agent',
                    'Mobile CI-CD Agent', 'Bug Hunter Agent'
                ],
                'enterprise': [
                    'Cloud Architecture Agent', 'Platform-DevOps Agent', 'GitOps CI-CD Agent',
                    'Cloud Security Agent', 'Observability Agent', 'SRE Agent',
                    'Threat Modeling Agent', 'Quality Gatekeeper Agent', 'Docs & Knowledge Agent',
                    'Release Manager Agent', 'Data & Analytics Agent', 'Test Strategy Agent',
                    'Performance & Efficiency Agent', 'Technology Critic & Improvement Agent'
                ]
            };

            const templateAgents = templates[templateId];
            if (!templateAgents) return;

            // Add all template agents to stack
            templateAgents.forEach(agentName => {
                if (!agentStack.includes(agentName)) {
                    agentStack.push(agentName);
                }
            });
            saveStack();
            updateStackUI();
            renderAgents(getCurrentFilteredAgents());

            // Open stack panel
            document.getElementById('stack-panel').classList.add('open');
        }

        function setupJourneyView() {
            document.getElementById('journey-add-selected').addEventListener('click', addSelectedToStack);
            document.getElementById('journey-open-stack').addEventListener('click', () => {
                document.getElementById('stack-panel').classList.add('open');
            });
        }

        function resetWizard() {
            wizardState = { step: 1, problem: null, platform: null, team: null };
            document.querySelectorAll('.wizard-option').forEach(opt => opt.classList.remove('selected'));
            updateWizardUI();
        }

        // Render Workflows
        function renderWorkflows() {
            const container = document.getElementById('workflows-container');
            container.innerHTML = workflows.map(w => `
                <div class="workflow-card fade-in" onclick="openWorkflowModal('${w.id}')" style="cursor: pointer;">
                    <div class="workflow-header">
                        <div class="workflow-icon ${w.color}">${w.icon}</div>
                        <div>
                            <div class="workflow-title">${w.title}</div>
                            <div class="workflow-subtitle">${w.agents.length} agentes en secuencia</div>
                        </div>
                    </div>
                    <div class="workflow-flow">
                        ${w.agents.map((agent, i) => {
                            const arrow = i < w.agents.length - 1 ? '<span class="workflow-arrow">→</span>' : '';
                            return `<span class="workflow-node" data-agent="${agent}">${agent}</span>${arrow}`;
                        }).join('')}
                    </div>
                    <div class="workflow-signals">
                        <div class="workflow-signals-title">Senales:</div>
                        <div class="workflow-signals-list">
                            ${w.signals.map(s => `<span class="signal-tag">${s}</span>`).join('')}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Render Phases Timeline
        function renderPhases() {
            const container = document.getElementById('phases-container');

            container.innerHTML = phases.map(phase => {
                const phaseWorkflows = workflows.filter(w => w.phase === phase.id);

                return `
                    <div class="phase-group phase-${phase.id}" data-phase="${phase.id}">
                        <div class="phase-header" onclick="togglePhase('${phase.id}')">
                            <div class="phase-icon">${phase.icon}</div>
                            <div class="phase-info">
                                <div class="phase-title">${phase.name}</div>
                                <div class="phase-description">${phase.description}</div>
                            </div>
                            <span class="phase-count">${phaseWorkflows.length} workflows</span>
                            <span class="phase-toggle">▼</span>
                        </div>
                        <div class="phase-workflows">
                            ${phaseWorkflows.map(w => `
                                <div class="phase-workflow-card" onclick="openWorkflowModal('${w.id}')">
                                    <div class="phase-workflow-header">
                                        <span class="phase-workflow-icon">${w.icon}</span>
                                        <span class="phase-workflow-title">${w.title}</span>
                                    </div>
                                    <div class="phase-workflow-agents">
                                        ${w.agents.map(a => `<span class="phase-workflow-agent" onclick="event.stopPropagation(); openAgentModal('${a}')">${a}</span>`).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function togglePhase(phaseId) {
            const group = document.querySelector(`.phase-group[data-phase="${phaseId}"]`);
            group.classList.toggle('expanded');
        }

        function openWorkflowModal(workflowId) {
            const workflow = workflows.find(w => w.id === workflowId);
            if (!workflow) return;

            const phase = phases.find(p => p.id === workflow.phase);
            const workflowText = `WORKFLOW: ${workflow.title}

FASE: ${phase ? phase.name : 'N/A'}

AGENTES EN SECUENCIA:
${workflow.agents.map((a, i) => `${i + 1}. ${a}`).join('\n')}

SEÑALES DE ACTIVACIÓN:
${workflow.signals.map(s => `- ${s}`).join('\n')}

FLUJO:
${workflow.agents.join(' → ')}`;

            document.getElementById('modal-icon').textContent = workflow.icon;
            document.getElementById('modal-title').textContent = workflow.title;
            document.getElementById('modal-subtitle').textContent = `Fase: ${phase ? phase.name : 'N/A'} • ${workflow.agents.length} agentes`;
            document.getElementById('modal-config').textContent = workflowText;
            document.getElementById('agent-modal').classList.add('show');
        }

        // Category Names for Dashboard
        const categoryNames = {
            architecture: 'Arquitectura',
            development: 'Desarrollo',
            quality: 'Calidad',
            security: 'Seguridad',
            cloud: 'Cloud & DevOps',
            transversal: 'Transversal',
            data: 'Datos & Analytics',
            mobile: 'Mobile',
            web: 'Web',
            languages: 'Lenguajes',
            migrations: 'Migraciones',
            'legacy-maintenance': 'Mantenimiento Legacy',
            roles: 'Roles & Liderazgo'
        };

        // Render Category Dashboard
        function renderCategoryDashboard() {
            const container = document.getElementById('category-grid');

            // Group agents by category
            const categoryGroups = {};
            agents.forEach(agent => {
                if (!categoryGroups[agent.category]) {
                    categoryGroups[agent.category] = [];
                }
                categoryGroups[agent.category].push(agent);
            });

            // Sort categories by count (descending)
            const sortedCategories = Object.entries(categoryGroups)
                .sort((a, b) => b[1].length - a[1].length);

            container.innerHTML = sortedCategories.map(([category, categoryAgents]) => {
                const preview = categoryAgents.slice(0, 3).map(a =>
                    `<li class="category-preview-agent" data-agent="${a.name}">${a.name}</li>`
                ).join('');
                return `
                    <div class="category-card" data-category="${category}">
                        <div class="category-card-header">
                            <span class="category-card-icon">${categoryIcons[category] || '📦'}</span>
                            <h3 class="category-card-title">${categoryNames[category] || category}</h3>
                            <span class="category-card-count">${categoryAgents.length}</span>
                        </div>
                        <ul class="category-card-preview">${preview}</ul>
                        <div class="category-card-footer">
                            <span class="category-card-link">Ver todos →</span>
                        </div>
                    </div>
                `;
            }).join('');

            // Add click handlers for preview agents (open modal)
            container.querySelectorAll('.category-preview-agent').forEach(agent => {
                agent.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const agentName = agent.dataset.agent;
                    openAgentModal(agentName);
                });
            });

            // Add click handlers for "Ver todos" link
            container.querySelectorAll('.category-card-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const card = link.closest('.category-card');
                    const category = card.dataset.category;

                    // Set category filter
                    container.querySelectorAll('.category-card').forEach(c => c.classList.remove('active'));
                    card.classList.add('active');
                    document.getElementById('category-filter').value = category;

                    // Trigger filter
                    filterAgents();

                    // Scroll to agents grid
                    document.getElementById('agents-container').scrollIntoView({ behavior: 'smooth', block: 'start' });
                });
            });

            // Add click handlers for category cards (toggle filter)
            container.querySelectorAll('.category-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    // Skip if clicked on agent or link
                    if (e.target.closest('.category-preview-agent') || e.target.closest('.category-card-link')) {
                        return;
                    }

                    const category = card.dataset.category;

                    // Toggle active state
                    const wasActive = card.classList.contains('active');
                    container.querySelectorAll('.category-card').forEach(c => c.classList.remove('active'));

                    if (!wasActive) {
                        card.classList.add('active');
                        // Set category filter
                        document.getElementById('category-filter').value = category;
                    } else {
                        // Clear filter
                        document.getElementById('category-filter').value = '';
                    }

                    // Trigger filter
                    filterAgents();

                    // Scroll to agents grid
                    document.getElementById('agents-container').scrollIntoView({ behavior: 'smooth', block: 'start' });
                });
            });
        }

        // Render Agents
        function renderAgents(filteredAgents = agents) {
            const container = document.getElementById('agents-container');
            container.innerHTML = filteredAgents.map(a => {
                const isInStack = agentStack.includes(a.name);
                return `
                <div class="agent-card fade-in" data-pack="${a.pack}" data-category="${a.category}" data-platform="${a.platform}" style="position: relative;">
                    <button class="agent-add-btn ${isInStack ? 'added' : ''}" data-agent="${a.name}" onclick="event.stopPropagation(); toggleAgentInStack('${a.name}')" title="${isInStack ? 'Quitar del stack' : 'Agregar al stack'}">
                        ${isInStack ? '✓' : '+'}
                    </button>
                    <div class="agent-header">
                        <div class="agent-icon cat-${a.category}">${categoryIcons[a.category]}</div>
                        <div class="agent-name">${a.name}</div>
                    </div>
                    <div class="agent-meta">
                        <span class="agent-tag tag-pack">${packNames[a.pack]}</span>
                        <span class="agent-tag tag-category">${a.category}</span>
                        <span class="agent-tag tag-platform">${a.platform}</span>
                    </div>
                </div>
            `}).join('');
        }

        function filterAgents() {
            const search = document.getElementById('search-input').value.toLowerCase().trim();
            const pack = document.getElementById('pack-filter').value;
            const category = document.getElementById('category-filter').value;
            const platform = document.getElementById('platform-filter').value;

            const filtered = agents.filter(a => {
                // Búsqueda por nombre
                const matchName = a.name.toLowerCase().includes(search);

                // Búsqueda por keywords semánticas
                let matchKeyword = false;
                if (search) {
                    // Buscar en todas las keywords que contengan el término de búsqueda
                    for (const [keyword, agentNames] of Object.entries(searchKeywords)) {
                        if (keyword.includes(search) || search.includes(keyword)) {
                            if (agentNames.includes(a.name)) {
                                matchKeyword = true;
                                break;
                            }
                        }
                    }
                }

                // Búsqueda en el contenido del config
                const matchConfig = search ? a.config.toLowerCase().includes(search) : false;

                // Match si coincide nombre, keyword o contenido
                const matchSearch = !search || matchName || matchKeyword || matchConfig;

                const matchPack = !pack || a.pack === pack;
                const matchCategory = !category || a.category === category;
                const matchPlatform = !platform || a.platform === platform || a.platform === 'multi';
                return matchSearch && matchPack && matchCategory && matchPlatform;
            });

            // Mostrar contador de resultados
            updateSearchResults(filtered.length, search);
            renderAgents(filtered);
        }

        function updateSearchResults(count, search) {
            let resultsDiv = document.getElementById('search-results-count');
            if (!resultsDiv) {
                resultsDiv = document.createElement('div');
                resultsDiv.id = 'search-results-count';
                resultsDiv.style.cssText = 'color: var(--text-secondary); font-size: 0.875rem; margin-top: 0.5rem;';
                document.querySelector('.catalog-filters').appendChild(resultsDiv);
            }
            if (search) {
                resultsDiv.textContent = `${count} agente${count !== 1 ? 's' : ''} encontrado${count !== 1 ? 's' : ''}`;
                resultsDiv.style.display = 'block';
            } else {
                resultsDiv.style.display = 'none';
            }
        }

        // Render Kits
        function renderKits() {
            const container = document.getElementById('kits-content');

            Object.entries(kits).forEach(([key, kit]) => {
                const isActive = key === 'startup' ? 'active' : '';
                const html = `
                    <div class="kit-content ${isActive}" data-kit="${key}">
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">${kit.description}</p>
                        ${kit.sections.map(section => `
                            <div class="kit-section">
                                <div class="kit-section-title">
                                    ${section.title}
                                    <span class="kit-badge badge-${section.badge}">${section.badge}</span>
                                </div>
                                <div class="kit-agents">
                                    ${section.agents.map(a => `<span class="kit-agent">${a}</span>`).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        function switchKit(kitId) {
            document.querySelectorAll('.kit-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.kit === kitId);
            });
            document.querySelectorAll('.kit-content').forEach(content => {
                content.classList.toggle('active', content.dataset.kit === kitId);
            });
        }

        // Tooltip
        function showTooltip(e, title, desc) {
            const tooltip = document.getElementById('tooltip');
            tooltip.querySelector('.tooltip-title').textContent = title;
            tooltip.querySelector('.tooltip-desc').textContent = desc;
            tooltip.style.left = e.pageX + 10 + 'px';
            tooltip.style.top = e.pageY + 10 + 'px';
            tooltip.classList.add('show');
        }

        function hideTooltip() {
            document.getElementById('tooltip').classList.remove('show');
        }

        // Navigation
        function setupNavigation() {
            const nav = document.getElementById('main-nav');
            const progressBar = document.getElementById('nav-progress');
            const backToTop = document.getElementById('back-to-top');
            const navLinks = document.querySelectorAll('.nav-links a');
            const sections = document.querySelectorAll('section[id]');

            // Click handlers for nav links
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // Scroll handler for nav shadow, progress bar, and back-to-top
            window.addEventListener('scroll', () => {
                // Nav shadow
                if (window.scrollY > 50) {
                    nav.classList.add('scrolled');
                } else {
                    nav.classList.remove('scrolled');
                }

                // Progress bar
                const scrollHeight = document.documentElement.scrollHeight - window.innerHeight;
                const scrollPercent = (window.scrollY / scrollHeight) * 100;
                progressBar.style.width = scrollPercent + '%';

                // Back to top button
                if (window.scrollY > 300) {
                    backToTop.classList.add('visible');
                } else {
                    backToTop.classList.remove('visible');
                }
            });

            // Back to top click
            backToTop.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            // IntersectionObserver for active section
            const observerOptions = {
                root: null,
                rootMargin: '-20% 0px -60% 0px',
                threshold: 0
            };

            const sectionObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const sectionId = entry.target.id;
                        navLinks.forEach(link => {
                            link.classList.remove('active');
                            if (link.dataset.section === sectionId) {
                                link.classList.add('active');
                            }
                        });
                    }
                });
            }, observerOptions);

            sections.forEach(section => {
                sectionObserver.observe(section);
            });
        }

        // ==================== GLOBAL SEARCH ====================
        function setupGlobalSearch() {
            const searchInput = document.getElementById('global-search-input');
            const searchResults = document.getElementById('global-search-results');
            let debounceTimer;

            // Search function
            function performGlobalSearch(query) {
                if (!query || query.length < 2) {
                    searchResults.classList.remove('show');
                    return;
                }

                query = query.toLowerCase();
                const results = {
                    agents: [],
                    workflows: [],
                    kits: []
                };

                // Search agents
                agents.forEach(agent => {
                    const matchName = agent.name.toLowerCase().includes(query);
                    let matchKeyword = false;
                    for (const [keyword, agentNames] of Object.entries(searchKeywords)) {
                        if (keyword.includes(query) && agentNames.includes(agent.name)) {
                            matchKeyword = true;
                            break;
                        }
                    }
                    if (matchName || matchKeyword) {
                        results.agents.push(agent);
                    }
                });

                // Search workflows
                workflows.forEach(workflow => {
                    if (workflow.title.toLowerCase().includes(query) ||
                        workflow.trigger.toLowerCase().includes(query) ||
                        workflow.description.toLowerCase().includes(query)) {
                        results.workflows.push(workflow);
                    }
                });

                // Search kits
                Object.entries(kits).forEach(([kitId, kit]) => {
                    if (kit.title.toLowerCase().includes(query) ||
                        kit.description.toLowerCase().includes(query)) {
                        results.kits.push({ id: kitId, ...kit });
                    }
                });

                // Render results
                renderGlobalSearchResults(results, query);
            }

            function renderGlobalSearchResults(results, query) {
                const totalResults = results.agents.length + results.workflows.length + results.kits.length;

                if (totalResults === 0) {
                    searchResults.innerHTML = `
                        <div class="search-no-results">
                            No se encontraron resultados para "${query}"
                        </div>
                    `;
                    searchResults.classList.add('show');
                    return;
                }

                let html = '';

                // Agents
                if (results.agents.length > 0) {
                    html += `
                        <div class="search-result-group">
                            <div class="search-result-group-title">Agentes (${results.agents.length})</div>
                            ${results.agents.slice(0, 5).map(agent => `
                                <div class="search-result-item" data-type="agent" data-name="${agent.name}">
                                    <span class="search-result-icon">${categoryIcons[agent.category] || '📦'}</span>
                                    <div class="search-result-text">
                                        <div class="search-result-name">${agent.name}</div>
                                        <div class="search-result-meta">${categoryNames[agent.category] || agent.category}</div>
                                    </div>
                                </div>
                            `).join('')}
                            ${results.agents.length > 5 ? `<div class="search-result-item" data-type="more-agents"><span class="search-result-meta">+${results.agents.length - 5} más...</span></div>` : ''}
                        </div>
                    `;
                }

                // Workflows
                if (results.workflows.length > 0) {
                    html += `
                        <div class="search-result-group">
                            <div class="search-result-group-title">Workflows (${results.workflows.length})</div>
                            ${results.workflows.slice(0, 3).map(workflow => `
                                <div class="search-result-item" data-type="workflow" data-title="${workflow.title}">
                                    <span class="search-result-icon">🔄</span>
                                    <div class="search-result-text">
                                        <div class="search-result-name">${workflow.title}</div>
                                        <div class="search-result-meta">${workflow.trigger}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                // Kits
                if (results.kits.length > 0) {
                    html += `
                        <div class="search-result-group">
                            <div class="search-result-group-title">Kits (${results.kits.length})</div>
                            ${results.kits.map(kit => `
                                <div class="search-result-item" data-type="kit" data-kit="${kit.id}">
                                    <span class="search-result-icon">📦</span>
                                    <div class="search-result-text">
                                        <div class="search-result-name">${kit.title}</div>
                                        <div class="search-result-meta">${kit.description.substring(0, 50)}...</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                searchResults.innerHTML = html;
                searchResults.classList.add('show');

                // Add click handlers
                searchResults.querySelectorAll('.search-result-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const type = item.dataset.type;

                        if (type === 'agent') {
                            const agentName = item.dataset.name;
                            const agent = agents.find(a => a.name === agentName);
                            if (agent) {
                                showAgentModal(agent);
                            }
                        } else if (type === 'workflow') {
                            const title = item.dataset.title;
                            const workflow = workflows.find(w => w.title === title);
                            if (workflow) {
                                showWorkflowModal(workflow);
                            }
                        } else if (type === 'kit') {
                            document.getElementById('kits-section').scrollIntoView({ behavior: 'smooth' });
                        } else if (type === 'more-agents') {
                            document.getElementById('search-input').value = searchInput.value;
                            filterAgents();
                            document.getElementById('catalog-section').scrollIntoView({ behavior: 'smooth' });
                        }

                        searchResults.classList.remove('show');
                        searchInput.value = '';
                    });
                });
            }

            // Input handler with debounce
            searchInput.addEventListener('input', (e) => {
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(() => {
                    performGlobalSearch(e.target.value);
                }, 200);
            });

            // Focus handler
            searchInput.addEventListener('focus', () => {
                if (searchInput.value.length >= 2) {
                    performGlobalSearch(searchInput.value);
                }
            });

            // Close on click outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('#global-search')) {
                    searchResults.classList.remove('show');
                }
            });

            // Keyboard shortcut Ctrl+K
            document.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                    e.preventDefault();
                    searchInput.focus();
                }
                // Escape to close
                if (e.key === 'Escape') {
                    searchResults.classList.remove('show');
                    searchInput.blur();
                }
            });
        }

        // ==================== STACK BUILDER ====================
        let agentStack = JSON.parse(localStorage.getItem('agentStack') || '[]');

        function toggleAgentInStack(agentName) {
            const index = agentStack.indexOf(agentName);
            if (index > -1) {
                agentStack.splice(index, 1);
            } else {
                agentStack.push(agentName);
            }
            saveStack();
            updateStackUI();
            renderAgents(getCurrentFilteredAgents());
        }

        function getCurrentFilteredAgents() {
            const search = document.getElementById('search-input').value.toLowerCase().trim();
            const pack = document.getElementById('pack-filter').value;
            const category = document.getElementById('category-filter').value;
            const platform = document.getElementById('platform-filter').value;

            return agents.filter(a => {
                const matchName = a.name.toLowerCase().includes(search);
                let matchKeyword = false;
                if (search) {
                    for (const [keyword, agentNames] of Object.entries(searchKeywords)) {
                        if (keyword.includes(search) && agentNames.includes(a.name)) {
                            matchKeyword = true;
                            break;
                        }
                    }
                }
                const matchConfig = search ? a.config.toLowerCase().includes(search) : false;
                const matchSearch = !search || matchName || matchKeyword || matchConfig;
                const matchPack = !pack || a.pack === pack;
                const matchCategory = !category || a.category === category;
                const matchPlatform = !platform || a.platform === platform || a.platform === 'multi';
                return matchSearch && matchPack && matchCategory && matchPlatform;
            });
        }

        function saveStack() {
            localStorage.setItem('agentStack', JSON.stringify(agentStack));
        }

        function updateStackUI() {
            const count = agentStack.length;
            const stackContent = document.getElementById('stack-content');
            const stackCount = document.getElementById('stack-count');
            const toggleCount = document.getElementById('stack-toggle-count');

            stackCount.textContent = count;
            toggleCount.textContent = count;
            toggleCount.style.display = count > 0 ? 'flex' : 'none';

            if (count === 0) {
                stackContent.innerHTML = `
                    <div class="stack-empty">
                        <div class="stack-empty-icon">📭</div>
                        <p>Tu stack está vacío</p>
                        <p style="font-size: 0.75rem; margin-top: 0.5rem;">Haz clic en + en las tarjetas de agentes para agregarlos</p>
                    </div>
                `;
            } else {
                stackContent.innerHTML = agentStack.map(agentName => {
                    const agent = agents.find(a => a.name === agentName);
                    if (!agent) return '';
                    return `
                        <div class="stack-item">
                            <span class="stack-item-icon">${categoryIcons[agent.category] || '📦'}</span>
                            <div class="stack-item-info">
                                <div class="stack-item-name">${agent.name}</div>
                                <div class="stack-item-category">${categoryNames[agent.category] || agent.category}</div>
                            </div>
                            <button class="stack-item-remove" onclick="toggleAgentInStack('${agent.name}')" title="Quitar">×</button>
                        </div>
                    `;
                }).join('');
            }
        }

        function copyAllStackConfigs() {
            if (agentStack.length === 0) {
                alert('El stack está vacío');
                return;
            }

            const configs = agentStack.map(name => {
                const agent = agents.find(a => a.name === name);
                return agent ? agent.config : '';
            }).filter(Boolean).join('\n\n---\n\n');

            navigator.clipboard.writeText(configs).then(() => {
                const btn = document.getElementById('stack-copy-all');
                const originalText = btn.innerHTML;
                btn.innerHTML = '✅ Copiado!';
                btn.style.background = 'var(--success)';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.style.background = '';
                }, 2000);
            });
        }

        function exportStackJSON() {
            if (agentStack.length === 0) {
                alert('El stack está vacío');
                return;
            }

            const stackData = agentStack.map(name => {
                const agent = agents.find(a => a.name === name);
                return agent ? { name: agent.name, pack: agent.pack, category: agent.category, platform: agent.platform, config: agent.config } : null;
            }).filter(Boolean);

            const blob = new Blob([JSON.stringify(stackData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'agent-stack.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function clearStack() {
            if (agentStack.length === 0) return;
            if (confirm('¿Estás seguro de que quieres limpiar el stack?')) {
                agentStack = [];
                saveStack();
                updateStackUI();
                renderAgents(getCurrentFilteredAgents());
            }
        }

        function setupStackBuilder() {
            const stackPanel = document.getElementById('stack-panel');
            const stackToggle = document.getElementById('stack-toggle');
            const stackClose = document.getElementById('stack-panel-close');

            stackToggle.addEventListener('click', () => {
                stackPanel.classList.toggle('open');
            });

            stackClose.addEventListener('click', () => {
                stackPanel.classList.remove('open');
            });

            document.getElementById('stack-copy-all').addEventListener('click', copyAllStackConfigs);
            document.getElementById('stack-export-json').addEventListener('click', exportStackJSON);
            document.getElementById('stack-clear').addEventListener('click', clearStack);

            // Initialize UI
            updateStackUI();
        }

        // ==================== STATS ====================
        function updateStats() {
            // Count unique packs
            const packs = new Set(agents.map(a => a.pack));
            document.getElementById('stat-packs').textContent = packs.size;

            // Count agents
            document.getElementById('stat-agents').textContent = agents.length;

            // Count workflows
            document.getElementById('stat-workflows').textContent = workflows.length;
            document.getElementById('workflow-count').textContent = workflows.length;
        }

        // ==================== EVENT LISTENERS ====================
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            updateStats();
            renderWorkflows();
            renderPhases();
            renderCategoryDashboard();
            renderAgents();
            renderKits();
            setupNavigation();
            setupGlobalSearch();
            setupStackBuilder();
            setupJourneyView();
            updateWizardUI();

            // Wizard option clicks
            document.getElementById('problem-options').addEventListener('click', (e) => {
                const option = e.target.closest('.wizard-option');
                if (option) selectOption(e.currentTarget, option.dataset.value, 'problem');
            });

            document.getElementById('platform-options').addEventListener('click', (e) => {
                const option = e.target.closest('.wizard-option');
                if (option) selectOption(e.currentTarget, option.dataset.value, 'platform');
            });

            document.getElementById('team-options').addEventListener('click', (e) => {
                const option = e.target.closest('.wizard-option');
                if (option) selectOption(e.currentTarget, option.dataset.value, 'team');
            });

            // Filter listeners
            document.getElementById('search-input').addEventListener('input', filterAgents);
            document.getElementById('pack-filter').addEventListener('change', filterAgents);
            document.getElementById('category-filter').addEventListener('change', filterAgents);
            document.getElementById('platform-filter').addEventListener('change', filterAgents);

            // Kit tabs
            document.querySelectorAll('.kit-tab').forEach(tab => {
                tab.addEventListener('click', () => switchKit(tab.dataset.kit));
            });

            // Workflow node tooltips
            document.addEventListener('mouseover', (e) => {
                if (e.target.classList.contains('workflow-node')) {
                    const agentName = e.target.dataset.agent || e.target.textContent;
                    showTooltip(e, agentName, 'Click para ver detalles del agente');
                }
            });

            document.addEventListener('mouseout', (e) => {
                if (e.target.classList.contains('workflow-node')) {
                    hideTooltip();
                }
            });

            // Agent card clicks - open modal
            document.getElementById('agents-container').addEventListener('click', (e) => {
                const card = e.target.closest('.agent-card');
                if (card) {
                    const agentName = card.querySelector('.agent-name').textContent;
                    openAgentModal(agentName);
                }
            });

            // Workflow node clicks - open modal
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('workflow-node')) {
                    const agentName = e.target.dataset.agent || e.target.textContent;
                    openAgentModal(agentName);
                }
            });

            // Kit agent clicks - open modal
            document.getElementById('kits-content').addEventListener('click', (e) => {
                if (e.target.classList.contains('kit-agent')) {
                    const agentName = e.target.textContent;
                    openAgentModal(agentName);
                }
            });

            // Close modal on overlay click
            document.getElementById('agent-modal').addEventListener('click', (e) => {
                if (e.target.classList.contains('modal-overlay')) {
                    closeModal();
                }
            });

            // Close modal on ESC
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeModal();
                }
            });
        });

        // ==================== MODAL FUNCTIONS ====================
        let currentAgentConfig = '';

        function openAgentModal(agentName) {
            // First check if there's a mapping for this workflow agent name
            const mappedName = agentNameMapping[agentName] || agentName;

            // Find agent by mapped name or fuzzy match
            const agent = agents.find(a =>
                a.name === mappedName ||
                a.name.toLowerCase().includes(mappedName.toLowerCase()) ||
                mappedName.toLowerCase().includes(a.name.toLowerCase().replace(' agent', ''))
            );

            if (!agent) {
                // If no exact match, show generic message
                document.getElementById('modal-icon').className = 'modal-icon cat-transversal';
                document.getElementById('modal-icon').textContent = '🤖';
                document.getElementById('modal-title').textContent = agentName;
                document.getElementById('modal-subtitle').textContent = 'Agente generico';
                document.getElementById('modal-config').textContent = `AGENTE: ${agentName}\n\nConfiguracion no disponible.\nEste agente es parte de un workflow pero su configuracion detallada no esta incluida en este catalogo.`;
                currentAgentConfig = `AGENTE: ${agentName}`;
            } else {
                document.getElementById('modal-icon').className = `modal-icon cat-${agent.category}`;
                document.getElementById('modal-icon').textContent = categoryIcons[agent.category];
                document.getElementById('modal-title').textContent = agent.name;
                document.getElementById('modal-subtitle').textContent = `${packNames[agent.pack]} | ${agent.category} | ${agent.platform}`;
                document.getElementById('modal-config').textContent = agent.config;
                currentAgentConfig = agent.config;
            }

            // Reset copy button
            const copyBtn = document.getElementById('copy-btn');
            copyBtn.classList.remove('copied');
            copyBtn.querySelector('.copy-text').textContent = 'Copiar Configuracion';
            copyBtn.querySelector('.copy-icon').textContent = '📋';

            // Show modal
            document.getElementById('agent-modal').classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('agent-modal').classList.remove('show');
            document.body.style.overflow = '';
        }

        async function copyConfig() {
            try {
                await navigator.clipboard.writeText(currentAgentConfig);

                // Show success feedback
                const copyBtn = document.getElementById('copy-btn');
                copyBtn.classList.add('copied');
                copyBtn.querySelector('.copy-text').textContent = 'Copiado!';
                copyBtn.querySelector('.copy-icon').textContent = '✓';

                // Reset after 2 seconds
                setTimeout(() => {
                    copyBtn.classList.remove('copied');
                    copyBtn.querySelector('.copy-text').textContent = 'Copiar Configuracion';
                    copyBtn.querySelector('.copy-icon').textContent = '📋';
                }, 2000);
            } catch (err) {
                console.error('Error al copiar:', err);
                alert('No se pudo copiar. Intenta seleccionar el texto manualmente.');
            }
        }
    </script>
</body>
</html>
